{"version":3,"sources":["../../../../../../assets/Script/gamecore/managers/assets/Script/gamecore/managers/SoundsManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/Script/gamecore/managers","sourcesContent":["import GameManager from \"./GameManager\";\n\n// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class SoundsManager extends cc.EventTarget {\n    //背景音乐\n    static bgSoundID: number = NaN;\n\n    //====================================================================================\n    //常用音效设置\n    //====================================================================================\n\n    //面板弹出声效素材地址\n    popUpSoundSource:string = null;\n    \n\n    //点击音效\n    tapSoundSource:string = null;\n    //====================================================================================\n\n    //场景背景音乐id\n    private senceBgSoundIDs: Array<number> = [];\n    private senceBgSoundURLs: Array<string> = [];\n\n    /**\n     *\n     */\n    constructor() {\n        super();\n\n        //读取本地数据\n        let v:any = cc.sys.localStorage.getItem(\"__l__soundsManager_soundMuted\");\n        if (v == \"true\") {\n            this.muteSound();\n        }\n\n        v = cc.sys.localStorage.getItem(\"__l__soundsManager_musicMuted\");\n        if (v == \"true\") {\n            this.muteMusic();\n        }\n    }\n\n    //推入场景音乐\n    pushSenceBgSound(sourceURL:string) {\n        let lastURL;\n        if (this.senceBgSoundURLs.length > 0) {\n             lastURL = this.senceBgSoundURLs[this.senceBgSoundURLs.length - 1];\n        }\n\n        if (lastURL != sourceURL) {\n            //如果当前有背景音乐，需要暂停\n            if (this.senceBgSoundURLs.length > 1) {\n                let lastBgSoundID:number = this.senceBgSoundIDs[this.senceBgSoundIDs.length - 1];\n                cc.audioEngine.pause(lastBgSoundID);\n            }\n\n            let id:number = cc.audioEngine.play(cc.url.raw(sourceURL), true, 1);\n            this.senceBgSoundIDs.push(id);\n            this.senceBgSoundURLs.push(sourceURL);\n\n            this.refreshBgSound();\n        }\n    }\n\n    //推出场景背景音乐（回到上一个场景的背景音乐）\n    popSenceBgSound() {\n        if (this.senceBgSoundURLs.length <= 1) return;\n\n        let bgSoundID:number = this.senceBgSoundIDs.pop();\n        cc.audioEngine.pause(bgSoundID);\n\n        this.senceBgSoundURLs.pop();\n\n        bgSoundID = this.senceBgSoundIDs[-1];\n        cc.audioEngine.resume(bgSoundID);\n\n        this.refreshBgSound();\n    }\n\n    //更新背景音乐\n    private refreshBgSound() {\n        //如果当前有背景音乐，需要暂停\n        if (this.senceBgSoundURLs.length == 0) return;\n        \n        let lastBgSoundID:number = this.senceBgSoundIDs[this.senceBgSoundIDs.length - 1];\n        cc.info(\"@@@lastBgSoundID\", lastBgSoundID);\n        if (this._musicMuted) {\n            cc.audioEngine.pause(lastBgSoundID);\n            cc.audioEngine.setVolume(lastBgSoundID, 0);\n        } else {\n            cc.audioEngine.resume(lastBgSoundID);\n            cc.audioEngine.setVolume(lastBgSoundID, 1);\n        }\n        \n    }\n\n\n\n\n\n    //是否已静音背景音乐\n    private _musicMuted:boolean = false;\n\n    get musicMuted():boolean {\n        return this._musicMuted;\n    }\n\n    //是否已静音特效声音\n    private _soundMuted:boolean = false;\n\n    get soundMuted():boolean {\n        return this._soundMuted;\n    }\n\n    //静音背景音乐\n    muteMusic() {\n        if (this._musicMuted) return;\n\n        this._musicMuted = true;\n        this.refreshBgSound();\n        \n        //本地保存\n        cc.sys.localStorage.setItem(\"__l__soundsManager_musicMuted\", this._musicMuted);\n    }\n\n\n    //取消静音背景音乐\n    unmuteMusic() {\n        if (!this._musicMuted) return;\n\n        this._musicMuted = false;\n        this.refreshBgSound();\n\n        //本地保存\n        cc.sys.localStorage.setItem(\"__l__soundsManager_musicMuted\", this._musicMuted);\n    }\n\n\n\n    //静音特效音乐\n    muteSound() {\n        if (this._soundMuted) return;\n\n        this._soundMuted = true;\n\n        //本地保存\n        cc.sys.localStorage.setItem(\"__l__soundsManager_soundMuted\", this._soundMuted);\n    }\n\n\n    //取消静音特效音乐\n    unmuteSound() {\n        if (!this._soundMuted) return;\n\n        this._soundMuted = false;\n\n        //本地保存\n        cc.sys.localStorage.setItem(\"__l__soundsManager_soundMuted\", this._soundMuted);\n    }\n\n    //播放音效\n    playSound(sourceURL:string) {\n        if (!sourceURL) return;\n        if (this._soundMuted) return;\n\n        cc.audioEngine.play(cc.url.raw(sourceURL), false, 1);\n    }\n\n\n    private _audioSource:cc.AudioSource;\n\n    //播放音效\n    playSoundClip(clip:cc.AudioClip):void {\n        //TODO:DEBUG\n        return;\n\n        if (!clip) return;\n        if (this._soundMuted) return;\n\n        if (!this._audioSource) {\n            this._audioSource = cc.director.getScene().addComponent(cc.AudioSource);\n        }\n\n        this._audioSource.clip = clip;\n        this._audioSource.play();\n    }\n\n\n\n    /**\n     * 播放点击音效。前提是已经设置了 SoundsManager.tapSoundSource;\n     */\n    playTapSound():void {\n        if (this.tapSoundSource) {\n            this.playSound(this.tapSoundSource);\n        }\n    }\n}\n"]}