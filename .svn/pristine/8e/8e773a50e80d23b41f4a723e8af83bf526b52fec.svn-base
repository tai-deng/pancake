{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Task/assets\\Script\\Task\\TaskItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Task","sourcesContent":["import WXCore from \"../gamecore/wechat/WXCore\";\r\nimport GameManager from \"../gamecore/managers/GameManager\";\r\nimport GameEventNames from \"../GameEventNames\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TaskItem extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    taskName:cc.Label = null;\r\n    @property(cc.Label)\r\n    taskDetails:cc.Label = null;\r\n    @property(cc.Label)\r\n    plan:cc.Label = null;\r\n    @property(cc.Node)\r\n    progress:cc.Node = null;\r\n    public itemTatus:object = {};\r\n    // public itemData:object =null;\r\n\r\n\r\n    //已领取按钮\r\n    @property(cc.SpriteFrame)\r\n    rewardedBtnSF:cc.SpriteFrame = null;\r\n    \r\n\r\n    itemIndex:number;\r\n\r\n    onLoad () {\r\n\r\n    }\r\n\r\n    start () {\r\n        this.init();\r\n    }\r\n\r\n\r\n    private _itemData:object;\r\n\r\n    get itemData():object {\r\n        return this._itemData;\r\n    }\r\n\r\n    set itemData(v:object) {\r\n        if (this._itemData != v) {\r\n            this._itemData = v;\r\n\r\n            this.init();\r\n        }\r\n    }\r\n\r\n    private init(){\r\n        if (!this._isOnLoadCalled) return;\r\n\r\n        if (!this._itemData) return;\r\n\r\n        let data = this.itemData;\r\n        this.taskName.string = data[\"title\"];\r\n        this.taskDetails.string = \"奖励钻石\"+data[\"awardNum\"]+\"颗\";\r\n        let planValue = StateManage.instance.getData(data[\"value\"]);\r\n        let temp = 0;\r\n        if(planValue >= data[\"goal\"]){\r\n            cc.find(\"right/bottom/affirm\",this.node).active = true;\r\n            cc.find(\"right/bottom/playbar\",this.node).active = false;\r\n            temp = data[\"goal\"];\r\n            this.itemTatus[\"finish\"] =1;\r\n            this.itemTatus[\"gain\"] = 2;\r\n        }else{\r\n            cc.find(\"right/bottom/affirm\",this.node).active = false;\r\n            cc.find(\"right/bottom/playbar\",this.node).active = true;\r\n            temp = planValue;\r\n            this.itemTatus[\"finish\"] =2;\r\n        }\r\n        \r\n        if(this.node.name == \"taskItem1\"){\r\n            if(StateManage.instance.getData(StateManage.KEY_ISGAINA) == 1){\r\n                this.itemTatus[\"gain\"] = 1\r\n                cc.find(\"right/bottom/affirm\",this.node).getComponent(cc.Sprite).spriteFrame = this.rewardedBtnSF;\r\n            }\r\n        }\r\n        if(this.node.name == \"taskItem2\"){\r\n            if(StateManage.instance.getData(StateManage.KEY_ISGAINB) == 1){\r\n                this.itemTatus[\"gain\"] = 1\r\n                cc.find(\"right/bottom/affirm\",this.node).getComponent(cc.Sprite).spriteFrame = this.rewardedBtnSF;\r\n            }\r\n        }\r\n        if(this.node.name == \"taskItem3\"){\r\n            if(StateManage.instance.getData(StateManage.KEY_ISGAINC) == 1){\r\n                this.itemTatus[\"gain\"] = 1\r\n                cc.find(\"right/bottom/affirm\",this.node).getComponent(cc.Sprite).spriteFrame = this.rewardedBtnSF;\r\n            }\r\n        }\r\n        this.plan.string = temp + \"/\" + data[\"goal\"];\r\n        this.progress.width = (116/data[\"goal\"]) * temp;\r\n    }\r\n\r\n    private refreshUI():void{\r\n\r\n        if (this.itemTatus[\"gain\"] == 1) {\r\n            cc.find(\"right/bottom/affirm\",this.node).getComponent(cc.Sprite).spriteFrame = this.rewardedBtnSF;\r\n            WXCore.showToast(\"今天的任务已经做完了!\")\r\n        } else {\r\n            cc.find(\"right/bottom/affirm\",this.node).getComponent(cc.Sprite).spriteFrame.setTexture(cc.url.raw(\"resources/taskBtn.png\"));\r\n        }\r\n        \r\n    }\r\n\r\n    /**\r\n     * 任务状态 1 完成了    2 未完成    finish\r\n     * 完成了   1 已领取    2 未领取    gain\r\n     */\r\n    // 完成任务获取指定奖励\r\n    public affirmBtn(event:cc.Event):void{\r\n        let script:TaskItem = this;\r\n        if(this.itemTatus[\"gain\"] == 2){\r\n            let temp = StateManage.instance.getData(this.itemData[\"awardName\"]) + this.itemData[\"awardNum\"];\r\n            StateManage.instance.setData(this.itemData[\"awardName\"],temp);\r\n            WXCore.showToast(\"完成任务获取\"+this.itemData[\"awardNum\"]+\"钻石奖励!\");\r\n        }\r\n        this.itemTatus[\"gain\"] = 1;\r\n        \r\n        if(this.node.name == \"taskItem1\"){\r\n            StateManage.instance.setData(StateManage.KEY_ISGAINA,1)\r\n        }\r\n        if(this.node.name == \"taskItem2\"){\r\n            StateManage.instance.setData(StateManage.KEY_ISGAINB,1)\r\n        }\r\n        if(this.node.name == \"taskItem3\"){\r\n            StateManage.instance.setData(StateManage.KEY_ISGAINC,1)\r\n        }\r\n\r\n        this.refreshUI();\r\n    }\r\n    // 开始游戏或者分享\r\n    public playbarBtn(event:cc.Event):void{\r\n        cc.log(\"开始游戏或者分享\");\r\n    }\r\n    // 刷新任务\r\n    public refresh(){\r\n        let title:string = \"\";\r\n        let script:TaskItem = this;\r\n        let callback:Function = function(){};\r\n        let taskNum = 0;\r\n        if(this.node.name == \"taskItem1\"){\r\n            taskNum = StateManage.instance.getData(StateManage.KEY_TASKNUMA);\r\n        }\r\n        if(this.node.name == \"taskItem2\"){\r\n            taskNum = StateManage.instance.getData(StateManage.KEY_TASKNUMB);\r\n        }\r\n        if(this.node.name == \"taskItem3\"){\r\n            taskNum = StateManage.instance.getData(StateManage.KEY_TASKNUMC);\r\n        }\r\n        if(taskNum > 0){\r\n            title = \"要观看一次广告来替换这个任务吗？\";\r\n            callback = function(label:string):void {\r\n                cc.info(label)\r\n                if (label == \"ok\") {\r\n                    script.affirm(taskNum-1);\r\n                }\r\n                if(label == \"off\"){\r\n\r\n                }\r\n            }\r\n        }else{\r\n            title = \"今天的任务刷新次数已使用完毕!\";\r\n        }\r\n        GameManager.eventManager.dispatchEventWith(GameEventNames.SHOW_ALERT, [title, callback])\r\n    }\r\n    // 确认更新\r\n    public affirm(num){\r\n        console.log(\"----------------------\")\r\n        this.node.dispatchEvent(new cc.Event(\"getData\", false))\r\n        if(this.node.name == \"taskItem1\"){\r\n            StateManage.instance.setData(StateManage.KEY_TASKNUMA,num);\r\n        }\r\n        if(this.node.name == \"taskItem2\"){\r\n            StateManage.instance.setData(StateManage.KEY_TASKNUMB,num);\r\n        }\r\n        if(this.node.name == \"taskItem3\"){\r\n            StateManage.instance.setData(StateManage.KEY_TASKNUMC,num);\r\n        }\r\n        this.init();\r\n    }\r\n    // update (dt) {}\r\n\r\n}\r\n"]}