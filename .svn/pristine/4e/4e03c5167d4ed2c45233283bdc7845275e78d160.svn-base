{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\scene/assets\\Script\\gamecore\\scene\\SceneManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\scene","sourcesContent":["import GameManager from \"../managers/GameManager\";\nimport RankSenceManager from \"../../module/init/RankSceneManager\";\nimport GameSceneManager from \"../../module/init/GameSceneManager\";\nimport LoadingSceneMain from \"./LoadingSceneMain\";\n\n// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n\n/**\n * 场景管理器\n */\n\n@ccclass\nexport default class SceneManager {\n\n    //加载场景最小显示时间(毫秒)\n    private static MIN_LOADING_TIME:number = 2000;\n    \n    //场景队列\n    private _sceneStack:Array<string> = [];\n\n\n    //加载场景。\n    //如果有设置加载场景，再切换场景时，会先进入加载场景\n    public loadingSceneName:string;\n\n    //当前场景\n    private _currentSceneName:string;\n\n\n    constructor() {\n        // cc.info(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\");\n        // cc.info(\"GameManager.sceneManager\", GameManager.sceneManager);\n        // if (GameManager.sceneManager) {\n        //     throw new Error(\"Please use GameManager.sceneManager\");\n        // }\n    }\n\n    /**\n     * 获取当前场景名称\n     */\n    public get currentSceneName():string {\n        return this._currentSceneName;\n    }\n\n\n\n    /**\n     * 推入场景\n     * \n     * @param sceneName 场景名称\n     */\n    public pushScene(sceneName:string):void {\n        this._sceneStack.push(sceneName);\n\n        this.loadScene(sceneName);\n    }\n\n    /**\n     * 预加载场景\n     * \n     * @param sceneName 场景名称\n     */\n    public preloadScene(sceneName:string, success:Function = null, fail:Function = null):void {\n        //预加载场景\n        cc.director.preloadScene(sceneName, function(err:Error):void {\n            cc.info(\"err\", err);\n            if (!err) {\n                if (success != null) success.call(null);\n            } else {\n                cc.info(\"场景\" + GameManager.sceneManager.currentSceneName + \"加载失败\");\n                if (fail != null) fail.call(null);\n            }\n        });\n    }\n\n\n\n    /**\n     * 推出场景，回到上一个场景\n     */\n    public popScene():string {\n        if (this._sceneStack.length > 1) {\n            let v:string = this._sceneStack.pop();\n\n            let toScene:string = this._sceneStack[this._sceneStack.length - 1];\n            this.loadScene(toScene);\n            return v;\n        }\n\n        return null;\n    }\n\n\n    /**\n     * 重置\n     * \n     */\n    public reset():void {\n        this._sceneStack = [];\n        this._currentSceneName = null;\n    }\n\n\n\n    /**\n     * 加载场景\n     * \n     * @param sceneName \n     */\n    private loadScene(sceneName:string) {\n        if (this._currentSceneName == sceneName) return;\n\n        //如果有设置加载场景\n        if (this.loadingSceneName) {\n            //不能同时加载多个场景\n            if (this._isLoading) return;\n\n            this._currentSceneName = sceneName;\n            this.showLoadingScene();\n            \n            //预加载场景\n            cc.director.preloadScene(sceneName, function(err:Error):void {\n                cc.info(\"err\", err);\n                if (!err) {\n                    GameManager.sceneManager.sceneLoadedCallback(sceneName);\n                } else {\n                    cc.info(\"场景\" + GameManager.sceneManager.currentSceneName + \"加载失败\");\n\n                    //返回到上一个场景\n                    GameManager.sceneManager._isLoading = false;\n                    GameManager.sceneManager.popScene();\n                }\n            })\n        } else {\n            this._currentSceneName = sceneName;\n            cc.director.loadScene(sceneName);\n        }\n    }\n\n\n\n    /**\n     * 场景加载完毕回调\n     * \n     * @param sceneName 加载的场景名\n     */\n    private sceneLoadedCallback(sceneName:string):void {\n        if (this._currentSceneName != sceneName) return;\n\n        //检查最小时间\n        let now:number = new Date().getTime();\n        cc.info(now - this._startLoadingTime);\n        if (now - this._startLoadingTime < SceneManager.MIN_LOADING_TIME) {\n            setTimeout(function():void {\n                GameManager.sceneManager.sceneLoadedCallback(sceneName);\n            }, 1000);\n            return;\n        }\n\n        //====================================================================\n        //尝试将加载场景通过动画方式移除\n        //====================================================================\n        //移除加载场景\n        let canvas:cc.Node = cc.find(\"Canvas\");\n        if (canvas) {\n            let loadingScript:LoadingSceneMain = canvas.getComponent(LoadingSceneMain);\n            if (loadingScript) {\n                cc.info(\"【sceneLoadedCallback】释放加载场景\");\n                loadingScript.doPreDestory(0.3);\n                \n                setTimeout(function():void {\n                    GameManager.sceneManager.showCurrentScene();\n                }, 400);\n                return;\n            }\n        }\n        //====================================================================\n\n        this.showCurrentScene();        \n    }\n\n\n    /**\n     * 显示当前场景\n     */\n    private showCurrentScene():void {\n        this._isLoading = false;\n        cc.director.loadScene(this._currentSceneName);\n    }\n\n\n    private _isLoading:boolean;\n\n    //开始加载的时间（毫秒）\n    private _startLoadingTime:number = 0;\n\n\n    /**\n     * 是否正在加载场景\n     */\n    public get isLoading():boolean {\n        return this._isLoading;\n    }\n\n    /**\n     * 显示加载场景\n     */\n    private showLoadingScene():void {\n        //记录开始显示加载场景的时间\n        this._startLoadingTime = new Date().getTime();\n\n        if (this._isLoading) return;\n        this._isLoading = true;\n\n        cc.director.loadScene(this.loadingSceneName);\n    }\n\n}\n"]}