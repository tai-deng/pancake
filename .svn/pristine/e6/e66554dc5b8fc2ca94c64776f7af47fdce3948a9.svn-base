
import Config from "../StateManage/StateManage.js";
import GameManager from "../gamecore/managers/GameManager.js";
import GameOverCommand from "../commands/GameOverCommand.js";
import Action from "../commands/Action.js";
import Over from "../commands/Over.js";
import StateManage from "../StateManage/StateManage.js";
const {ccclass, property} = cc._decorator;

@ccclass
export default class Game extends cc.Component {
    @property(cc.Node)
    homeBar:cc.Node = null;
    @property(cc.Node)
    animNode:cc.Node
    @property(cc.Animation)
    anim:cc.Animation;

    private _isTouching:boolean = false;
    public static actionPrefab:Boolean = false;

    private _actionNode:cc.Node;

    onLoad () {
        cc.director.getPhysicsManager().enabled = true;
        cc.director.getPhysicsManager().debugDrawFlags = 0;
        let script:Game = this;
        this.animNode.active = false;
        if(!Game.actionPrefab){
            cc.loader.loadRes("action", function(err, prefab){
                Game.actionPrefab = prefab;
                script._actionNode = cc.instantiate(prefab);
                script.node.addChild(script._actionNode);
            });
            cc.loader.loadRes("over", function(err, prefab){
                let newNode:cc.Node = cc.instantiate(prefab);
                script.node.addChild(newNode);
                Over.instance.initialize(newNode);
            });
        }
    }
    // 打鸡蛋
    private playEgg(){
        this.animNode.active = true;
        this.anim.play("animotion");
    }
    // 移除动画
    private Finished(){
        this.animNode.active = false;
    }
    // 返回首页
    private homePage(e:cc.Event):void {
        cc.director.loadScene("index");
    }
    start () {
        this.homeBar.on(cc.Node.EventType.TOUCH_END, this.homePage, this);
        this.anim.on("finished",this.Finished, this);
        // GameManager.context.mapEvent("gameover", GameOverCommand);
    }
    /* update (dt) {
        if (this._isTouching) {
           this._actionNode.getComponent(Action).strength();
        }
       this._actionNode.getComponent(Action).crash();
    } */
}
