{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\managers\\item/assets\\Script\\gamecore\\managers\\item\\ItemManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\managers\\item","sourcesContent":["import ItemBase from \"./ItemBase\";\nimport ItemTypes from \"./ItemTypes\";\nimport GameManager from \"../GameManager\";\nimport GameCoreEvent from \"../../GameCoreEvent\";\n\n// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n/**\n * 道具管理器\n */\n\n@ccclass\nexport default class ItemManager {\n\n\n\n    //道具\n    private _allItems:Array<ItemBase> = [];\n\n\n    /**\n     * 获取道具\n     */\n    public get allItems():Array<ItemBase> {\n        return this._allItems.concat();\n    }\n\n    /**\n     * 根据道具名称获取道具\n     * \n     * @param itemName 道具名称\n     */\n    public getItemsByName(itemName:string):Array<ItemBase> {\n        let items:Array<ItemBase> = [];\n\n        this._allItems.forEach(function(ele:ItemBase):void {\n            if (ele.name == itemName) {\n                items.push(ele);\n            }\n        })\n        return items;\n    }\n\n\n    /**\n     * 道具被使用次数\n     */\n    private _inGameItemUsedCount:object = {};\n    private _globalItemUsedCount:object = {};\n\n\n    /**\n     * 获取某个游戏中道具在游戏中使用的次数\n     * \n     * @param itemName \n     */\n    public getInGameItemUsedCount(itemName:string):number {\n        let v:number;\n        if (this._inGameItemUsedCount[itemName] != undefined) {\n            v = this._inGameItemUsedCount[itemName];\n        } else if (this._globalItemUsedCount[itemName] != undefined) {\n            v = this._globalItemUsedCount[itemName];\n        } \n\n        if (isNaN(v) || v < 0) v = 0;\n\n        return v;\n    }\n\n\n    /**\n     * 使用道具\n     * \n     * @param item \n     */\n    public useItem(item:ItemBase):void {\n        let itemName:string = item.name;\n        cc.info(\"used item \" + itemName);\n\n        //检查道具是否存在\n        let index:number = this._allItems.indexOf(item);\n        if (index == -1) return;\n\n        if (item.type == ItemTypes.IN_GAME) {\n            let v:number = this._inGameItemUsedCount[itemName];\n            if (isNaN(v) || v < 0) v = 0;\n            this._inGameItemUsedCount[itemName] = v + 1;\n        } else if (item.type == ItemTypes.GLOBAL) {\n            let v:number = this._globalItemUsedCount[itemName];\n            if (isNaN(v) || v < 0) v = 0;\n            this._globalItemUsedCount[itemName] = v + 1;\n        }\n\n        //使用道具\n        item.useItem();\n\n        //删除\n        this._allItems.splice(index, 1);\n\n        //抛出事件\n        GameManager.eventManager.dispatchEventWith(GameCoreEvent.ITEM_USED, item);\n\n    }\n\n\n\n    /**\n     * 添加道具\n     * \n     * @param item \n     */\n    public addItem(item:ItemBase):void {\n        if (!item || item.type == ItemTypes.ABSTRACT) return;\n\n        if (this._allItems.indexOf(item) == -1) {\n            this._allItems.push(item);\n\n            cc.info(\"添加道具\", item.name);\n\n            //抛出事件\n            GameManager.eventManager.dispatchEventWith(GameCoreEvent.ITEM_ADDED, item);\n        }\n    }\n\n\n    /**\n     * 移除道具\n     * \n     * @param item \n     */\n    public removeItem(item:ItemBase):void {\n        let index:number = this.allItems.indexOf(item);\n        if (index != -1) {\n            this._allItems.splice(index, 1);\n\n            //抛出事件\n            GameManager.eventManager.dispatchEventWith(GameCoreEvent.ITEM_REMOVED, item);\n        }\n    }\n\n\n\n    /**\n     * 当游戏结束时，调用该方法，让游戏中道具数据清空。\n     */\n    public gameEnded():void {\n        for (let i:number = 0; i < this._allItems.length; i++) {\n            let item:ItemBase = this._allItems[i];\n            if (item.type == ItemTypes.IN_GAME) {\n                this._allItems.splice(i, 1);\n                i--;\n            }\n        }\n\n        this._inGameItemUsedCount = {};\n    }\n\n}\n"]}