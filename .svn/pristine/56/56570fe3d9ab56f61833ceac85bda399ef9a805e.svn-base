{"version":3,"sources":["AdButton.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\xiaoyaoji","sourcesContent":["import { TweenLite, Ease } from \"../libs/TweenLite\";\r\nimport { Bounce, Elastic } from \"../libs/EasePack\";\r\nimport GameManager from \"../managers/GameManager\";\r\nimport XYJAPI from \"./XYJAPI\";\r\nimport WXCore from \"../wechat/WXCore\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 广告按钮\r\n */\r\n\r\n@ccclass\r\nexport default class AdButton extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    button:cc.Node = null;\r\n\r\n    /**\r\n     * 动画间隔\r\n     */\r\n    effectDelay:number = 3;\r\n\r\n    start () {\r\n        this.button.on(cc.Node.EventType.TOUCH_END, this.adBtnClickHandler, this);\r\n\r\n        this.showEffect();\r\n\r\n        this.schedule(this.getAdData, 2, 1);\r\n\r\n        //默认不可见\r\n        // this.node.active = false;\r\n        this.node.opacity = 0;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * {\r\n     *      imageurl: \"https://ball.yz071.com/Upload/image/2018-06-06/P_15282657218141544.jpg \", \r\n     *      title: \"篮球大作战\", \r\n     *      bili: \"4:3\"\r\n     * }\r\n     */\r\n    private _adData:object;\r\n\r\n    private getAdData():void {\r\n        cc.info(\"get ad data\");\r\n        if (this._adData) return;\r\n\r\n        //请求数据\r\n        let script:AdButton = this;\r\n        XYJAPI.getAdImageData(function(data:object):void {\r\n            if (data && data[\"imageurl\"]) {\r\n                script._adData = data;\r\n                //script.node.active = true;\r\n                script.node.opacity = 255;\r\n            }\r\n        });\r\n\r\n        this.schedule(this.getAdData, 3, 1);\r\n    }\r\n\r\n\r\n    // update (dt) {}\r\n\r\n    /**\r\n     * 广告按钮点击\r\n     * @param e \r\n     */\r\n    private adBtnClickHandler(e:cc.Event.EventTouch):void {\r\n        GameManager.soundsManager.playTapSound();\r\n\r\n        //预览图片\r\n        if (this._adData) {\r\n            WXCore.previewImage([this._adData[\"imageurl\"]]);\r\n        }\r\n    }\r\n\r\n    //缓动实例\r\n    private _tweenlites:Array<any> = [];\r\n\r\n    private killAll():void {\r\n        if (this._tweenlites.length > 0) {\r\n            for (let i:number = 0; i < this._tweenlites.length; i++) {\r\n                this._tweenlites[i].kill();\r\n            }\r\n        }\r\n\r\n        this._tweenlites = [];\r\n    }\r\n\r\n    /**\r\n     * 播放效果\r\n     */\r\n    private showEffect():void {\r\n        this.killAll();\r\n        \r\n        if (this._adData) {\r\n            if (Math.random() > 0.5) {\r\n                this.effectZoom();\r\n            } else {\r\n                this.effectShake();\r\n            }\r\n        }\r\n\r\n        this.schedule(this.showEffect, this.effectDelay + Math.random(), 1);\r\n    }\r\n\r\n\r\n    private shakeTween:any;\r\n\r\n    /**\r\n     * 晃动\r\n     */\r\n    private effectShake():void {\r\n        let toR:number = (40 + Math.random() * 10) * (Math.random() > 0.5 ? 1 : -1);\r\n        \r\n        let t:any = TweenLite.to(this.button, 0.5, {\"rotation\":toR});\r\n        this._tweenlites.push(t);\r\n\r\n        t = TweenLite.to(this.button, 0.8, {\r\n            \"delay\":0.5,\r\n            \"rotation\":0,\r\n            \"ease\":Elastic.easeOut\r\n        });\r\n        this._tweenlites.push(t);\r\n\r\n    }\r\n\r\n\r\n    private zoomTween:any;\r\n\r\n    /**\r\n     * 缩放\r\n     */\r\n    private effectZoom():void {\r\n        if (this.zoomTween) this.zoomTween.kill();\r\n        if (this.shakeTween) this.zoomTween.kill();\r\n\r\n        let toS:number = 0.6 + Math.random() * 0.2;\r\n        let t:any = TweenLite.to(this.button, 0.5, {\"scale\":toS});\r\n        this._tweenlites.push(t);\r\n\r\n        t = TweenLite.to(this.button, 0.8, {\r\n            \"delay\":0.5,\r\n            \"scale\":1,\r\n            \"ease\":Elastic.easeOut\r\n        });\r\n        this._tweenlites.push(t);\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        this.killAll();\r\n\r\n        this.unschedule(this.showEffect);\r\n        this.unschedule(this.getAdData);\r\n\r\n    }\r\n}\r\n"]}