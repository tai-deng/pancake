{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\shopping/assets\\Script\\shopping\\goods.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\shopping","sourcesContent":["import StateManage from \"../StateManage/StateManage\";\r\nimport WXCore from \"../gamecore/wechat/WXCore\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class NewClass extends cc.Component {\r\n    // 配置\r\n    public deploy:any = null;\r\n    private sumShop:Array<cc.Node> = null;\r\n    private shopPrice:number = null;\r\n\r\n    // item 按钮\r\n    public itemBtn(event:cc.Event, data){\r\n        let item = event.target;\r\n        if(this.deploy.isBuy==1){\r\n            if(this.deploy.isUse == 1){\r\n                WXCore.showToast(\"皮肤已在使用中\");\r\n            }else if(this.deploy.isUse == 2){\r\n                cc.find(\"use\",item).active = false;\r\n                cc.find(\"inUse\",item).active = true;\r\n                this.ergodic();\r\n                this.deploy.isUse = 1;\r\n                WXCore.showToast(\"使用成功!\")\r\n                StateManage.instance.setData(StateManage.KEY_SKIN,this.deploy.skinsRes);\r\n                cc.log(this.deploy.skinsRes,2)\r\n            }\r\n        }else if(this.deploy.isBuy == 2){\r\n            if(this.deploy.waitBuy == 1){\r\n                cc.find(\"Canvas/toast\").active = true;\r\n                StateManage.instance.setData(StateManage.KEY_TRADE,this.deploy);\r\n            }else if(this.deploy.waitBuy == 2){\r\n                WXCore.showToast(\"购买上一个皮肤后解锁\")\r\n            }\r\n        }\r\n    }\r\n    // 遍历改变商品\r\n    private ergodic(){\r\n        this.sumShop = this.node.parent.children;\r\n        this.sumShop.forEach(el =>{\r\n            if(el.getComponent(\"goods\").deploy.isUse == 1){\r\n                cc.find(\"use\",el).active = true;\r\n                cc.find(\"inUse\",el).active = false;\r\n                el.getComponent(\"goods\").deploy.isUse = 2;\r\n            }\r\n        })\r\n    }\r\n    // 取消购买\r\n    public cancelBuy(event, customEventData){\r\n        cc.log(\"取消购买\");\r\n        cc.find(\"Canvas/toast\").active = false;\r\n        // cc.find(\"Canvas/toast/affirm\").active = false;\r\n        // cc.find(\"Canvas/toast/buyInfo\").active = false;\r\n    }\r\n    // 确认购买\r\n    public affirmBuy(event, customEventData){\r\n        let myGem = StateManage.instance.getData(StateManage.KEY_GEM);\r\n        let trade = StateManage.instance.getData(StateManage.KEY_TRADE);\r\n        let shopPrice = Number(trade.price)\r\n        let showInfo = '';\r\n        cc.log(shopPrice)\r\n        if(myGem >=shopPrice){\r\n            let surplus = (myGem - shopPrice) <= 0 ? 0 :(myGem - shopPrice);\r\n            StateManage.instance.setData(StateManage.KEY_GEM,surplus);\r\n            showInfo = \"购买成功，同时解锁了新购买项！\";\r\n            cc.log(\"购买成功\",shopPrice)\r\n            // 购买成功解锁并使用当前皮肤 让下一个皮肤待解锁 msk\r\n            let sumShop = cc.find(\"Canvas\").getComponent(\"shopping\").container.children;\r\n            var currentInd = 0;\r\n            for(let i = 0;i < sumShop.length; ++i){\r\n                if(sumShop[i].getComponent(\"goods\").deploy.isBuy == 1){\r\n                    cc.find(\"use\",sumShop[i]).active = true;\r\n                    cc.find(\"inUse\",sumShop[i]).active = false;\r\n                    sumShop[i].getComponent(\"goods\").deploy.isUse = 2;\r\n                }\r\n                if(trade.id == sumShop[i].getComponent(\"goods\").deploy.id){\r\n                    currentInd = i;\r\n                    sumShop[i].getComponent(\"goods\").deploy.isBuy = 1;\r\n                    sumShop[i].getComponent(\"goods\").deploy.isUse = 1;\r\n                    sumShop[i].getComponent(\"goods\").deploy.waitBuy = 1;\r\n                    cc.find(\"use\",sumShop[i]).active = false;\r\n                    cc.find(\"inUse\",sumShop[i]).active = true;\r\n                    cc.find(\"price\",sumShop[i]).active = false;\r\n                    cc.find(\"prop\",sumShop[i]).active = true;\r\n                    cc.find(\"lock\",sumShop[i]).active = false;\r\n                    cc.find(\"msk\",sumShop[i]).active = false;\r\n                    StateManage.instance.setData(StateManage.KEY_SKIN,sumShop[i].getComponent(\"goods\").deploy.skinsRes);\r\n                    cc.log(sumShop[i].getComponent(\"goods\").deploy.skinsRes,3)\r\n                }\r\n            }\r\n            let wait:cc.Node = sumShop[currentInd+1];\r\n            cc.find(\"use\",wait).active = false;\r\n            cc.find(\"inUse\",wait).active = false;\r\n            cc.find(\"price\",wait).active = true;\r\n            cc.find(\"prop\",wait).active = true;\r\n            cc.find(\"lock\",wait).active = false;\r\n            cc.find(\"msk\",wait).active = true;\r\n            wait.getComponent(\"goods\").deploy.waitBuy = 1;\r\n            let price = cc.find(\"price/money\",wait).getComponent(cc.Label).string;\r\n            if(myGem >= price){\r\n                wait.color = new cc.Color(17, 30, 131);\r\n            }else{\r\n                wait.color = new cc.Color(141, 22, 26);\r\n            }\r\n            if(wait.getComponent(\"goods\").deploy.newPro == 1){\r\n                cc.find(\"newPro\",wait).active = true;\r\n            }else{\r\n                cc.find(\"newPro\",wait).active = false;\r\n            }\r\n        }else{\r\n            showInfo = \"宝石不足\";\r\n            cc.log(\"购买失败\",shopPrice)\r\n        }\r\n        cc.find(\"Canvas/toast\").active = false;\r\n        WXCore.showToast(showInfo)\r\n    }\r\n    // onLoad () {\r\n    // }\r\n\r\n    // start () {\r\n    // }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}