{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\commands/assets\\Script\\commands\\Action.ts"],"names":[],"mappings":";;;;;AAGA,0DAAqD;AACrD,2CAAqC;AACrC,qCAAgC;AAE1B,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAC1C,SAAS;AAET;IAAoC,0BAAY;IADhD;QAAA,qEA2JC;QAvJG,aAAO,GAAkB,EAAE,CAAC;QAE5B,aAAO,GAAW,IAAI,CAAC;QAEvB,SAAG,GAAW,IAAI,CAAC;QAEnB,YAAM,GAAW,IAAI,CAAC;QAEf,WAAK,GAAW,IAAI,CAAC;QACpB,iBAAW,GAAW,KAAK,CAAC;QAC5B,gBAAU,GAAkB,EAAE,CAAC;;IA6I3C,CAAC;IA3IG,uBAAM,GAAN;QACI,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACnB,qBAAW,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC;IACrE,CAAC;IACD,sBAAK,GAAL;QACI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAC;QACjF,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;IACjF,CAAC;IACD,QAAQ;IACR,2BAAU,GAAV,UAAW,KAAY;QAAvB,iBA8BC;QA7BG,yEAAyE;QACzE,IAAG,KAAK,IAAI,CAAC,EAAC;YACV,oDAAoD;YACpD,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,aAAa,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC;YACzD,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;YAC9C,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;YACvD,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YACjD,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAA,OAAO;gBACxB,IAAI,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;gBAC7C,IAAI,GAAG,GAAI,OAAO,CAAC,WAAW,EAAE,CAAA;gBAChC,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;gBACzB,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;gBACd,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;gBACnC,IAAI,CAAC,cAAc,GAAG,KAAI,CAAC,cAAc,CAAC;YAC9C,CAAC,CAAC,CAAC;SACN;aAAK,IAAG,KAAK,IAAI,CAAC,EAAC;YAChB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAA,OAAO;gBACxB,IAAI,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;gBAC7C,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;YAClB,CAAC,CAAC,CAAC;SACN;aAAK,IAAG,KAAK,IAAI,CAAC,EAAC;YAChB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAS,OAAO,EAAC,KAAK;gBACvC,IAAI,IAAI,GAAG,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAA;gBAC7C,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAA;gBAC3C,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;YAClB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACd,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,UAAU,EAAC,CAAC,CAAC,CAAA;SACzD;IACL,CAAC;IACD,QAAQ;IACA,+BAAc,GAAtB,UAAuB,OAAyB,EAAC,YAA+B,EAAC,aAAgC;QAC7G,IAAI,GAAG,GAAU,aAAa,CAAC,KAAK,CAAC,CAAC;QACtC,OAAO;QACP,IAAG,GAAG,IAAI,GAAG,EAAC;YACV,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YACxB,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,eAAe,EAAC,CAAC,CAAC,CAAC;SAC/D;QACD,QAAQ;QACR,IAAG,GAAG,IAAI,GAAG,EAAE;YACX,IAAI,KAAK,GAAG,MAAM,CAAC,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,CAAC;YAC7E,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,SAAS,EAAC,KAAK,CAAC,CAAC;YAE1D,IAAI,GAAG,GAAG,MAAM,CAAC,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;YACxE,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,OAAO,EAAC,GAAG,CAAC,CAAC;YACtD,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,eAAe,EAAC,CAAC,CAAC,CAAC;SAC/D;IACL,CAAC;IACD,OAAO;IACA,yBAAQ,GAAf;QACI,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;IAC1G,CAAC;IACD,KAAK;IACE,sBAAK,GAAZ;QACI,IAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,UAAU,CAAC,IAAE,CAAC,EAAC;YAC1E,IAAI,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,cAAc,EAAE,CAAC;YACvE,IAAI,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,cAAc,EAAE,CAAC;YACnE,IAAG,IAAI,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAC,EAAE,EAAC;gBACjB,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,UAAU,EAAC,CAAC,CAAC,CAAC;aAC1D;SACJ;IACL,CAAC;IACD,OAAO;IACC,kCAAiB,GAAzB,UAA0B,CAAU;QAChC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACnB,IAAI,CAAC,UAAU,EAAE,CAAC;IACtB,CAAC;IACD,OAAO;IACC,gCAAe,GAAvB,UAAwB,CAAU;QAC9B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IAC7B,CAAC;IACD,QAAQ;IACA,2BAAU,GAAlB;QACI,IAAI,OAAO,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,QAAQ,CAAC,CAAC;QACjE,IAAI,GAAG,GAAG,IAAI,cAAI,EAAE,CAAC,KAAK,CAAC;QAC3B,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,GAAG,CAAC,OAAO,CAAC,UAAA,EAAE;YACV,IAAG,EAAE,CAAC,MAAM,CAAC,IAAI,OAAO,EAAC;gBACrB,OAAO,GAAG,EAAE,CAAC;aAChB;QACL,CAAC,CAAC,CAAA;QACF,EAAE,CAAC,GAAG,CAAC,OAAO,EAAC,OAAO,CAAC,CAAA;QAEvB,IAAI,aAAa,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;QAClD,IAAI,gBAAgB,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC;QACvD,IAAI,UAAU,GAAG,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;QAE7C,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;QAC9F,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;QACtJ,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;IAEhJ,CAAC;IACD,QAAQ;IACA,mCAAkB,GAA1B,UAA2B,CAAU;QACjC,IAAI,GAAG,GAAU,qBAAW,CAAC,QAAQ,CAAC,cAAc,CAAC;QACrD,OAAO;QACP,IAAI,GAAG,IAAI,qBAAW,CAAC,eAAe,IAAI,qBAAW,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,EAAE;YACvE,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAK,CAAC,CAAC,MAAM,EAAE,CAAC;SAC5C;QACD,IAAI,GAAG,IAAI,qBAAW,CAAC,eAAe,IAAI,qBAAW,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,EAAE;YACvE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;SAC9B;QACD,OAAO;QACP,IAAI,GAAG,IAAI,qBAAW,CAAC,SAAS,EAAE;YAC9B,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,SAAS,CAAC,CAAC;SAClG;QACD,MAAM;QACN,IAAI,GAAG,IAAI,qBAAW,CAAC,QAAQ,EAAE;YAC7B,qBAAqB;SACxB;QACD,iCAAiC;QACjC,IAAI,GAAG,IAAI,qBAAW,CAAC,UAAU,IAAI,qBAAW,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,EAAE;YACnE,EAAE,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC;SACtD;aAAK,IAAI,GAAG,IAAI,qBAAW,CAAC,UAAU,IAAI,qBAAW,CAAC,QAAQ,CAAC,MAAM,IAAI,CAAC,EAAC;YACxE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;SACtB;IACL,CAAC;IACD,uBAAM,GAAN,UAAQ,EAAE;QACN,IAAI,IAAI,CAAC,WAAW,EAAE;YACnB,IAAI,CAAC,QAAQ,EAAE,CAAC;SAClB;QACF,IAAI,CAAC,KAAK,EAAE,CAAC;IAChB,CAAC;IAGD,0BAAS,GAAT;QACI,qBAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;IAChE,CAAC;IAtJD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2CACU;IAE5B;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2CACK;IAEvB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;uCACC;IAEnB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;0CACI;IATL,MAAM;QAD1B,OAAO;OACa,MAAM,CA0J1B;IAAD,aAAC;CA1JD,AA0JC,CA1JmC,EAAE,CAAC,SAAS,GA0J/C;kBA1JoB,MAAM","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\commands","sourcesContent":["import GameManager from \"../gamecore/managers/GameManager\";\r\nimport Over from \"./Over\";\r\nimport Game from \"../Game/Game\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\nimport Jewel from \"../Jewels/Jewels\";\r\nimport Json from \"../Json/Json\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n// 手臂类执行体\r\n@ccclass\r\nexport default class Action extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    pancake:Array<cc.Node> = [];\r\n    @property(cc.Node)\r\n    terrace:cc.Node = null;\r\n    @property(cc.Node)\r\n    arm:cc.Node = null;\r\n    @property(cc.Node)\r\n    jewels:cc.Node = null;\r\n\r\n    public score:cc.Node = null;\r\n    private _isTouching:boolean = false;\r\n    private pancakePos:Array<cc.Vec2> = [];\r\n\r\n    onLoad(){\r\n        this.initialize(1);\r\n        StateManage.instance.on(\"change\", this.stateChangeHandler, this);\r\n    }\r\n    start(){\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_START, this.touchStartHandler, this);\r\n        this.node.parent.on(cc.Node.EventType.TOUCH_END, this.touchEndHandler, this);\r\n    }\r\n    // 初始化钢体\r\n    initialize(cases:number):void{\r\n        // StateManage.instance.setData(StateManage.KEY_CAKEPOS,this.pancakePos);\r\n        if(cases == 1){\r\n            // this.pancake = cc.instantiate(this.pancakPrefab);\r\n            this.pancake = cc.find(\"pancakeNode\",this.node).children;\r\n            this.score = cc.find(\"Canvas/describe/score\");\r\n            this.terrace = cc.find(\"hands/pot/terrace\", this.node);\r\n            this.arm = cc.find(\"hands/bigArm\",this.node);\r\n            this.jewels = this.node.getChildByName(\"jewels\");\r\n            this.pancake.forEach(element => {\r\n                let temp = element.getComponent(cc.RigidBody)\r\n                let pos  = element.getPosition()\r\n                this.pancakePos.push(pos)\r\n                temp.type = 1;\r\n                temp.enabledContactListener = true;\r\n                temp.onBeginContact = this.onBeginContact;\r\n            });\r\n        }else if(cases == 2){\r\n            this.pancake.forEach(element => {\r\n                let temp = element.getComponent(cc.RigidBody)\r\n                temp.type = 2;\r\n            });\r\n        }else if(cases == 3){\r\n            this.pancake.forEach(function(element,index){\r\n                let temp = element.getComponent(cc.RigidBody)\r\n                element.setPosition(this.pancakePos[index])\r\n                temp.type = 0;\r\n            }.bind(this));\r\n            StateManage.instance.setData(StateManage.KEY_ISOVER,2)\r\n        }\r\n    }\r\n    // 饼碰撞开始\r\n    private onBeginContact(contact:cc.PhysicsContact,selfCollider:cc.PhysicsCollider,otherCollider:cc.PhysicsCollider){\r\n        let tag:number = otherCollider[\"tag\"];\r\n        // 碰撞到锅\r\n        if(tag != 100){\r\n            contact.disabled = true;\r\n            StateManage.instance.setData(StateManage.KEY_JEWEL_STATE,1);\r\n        }\r\n        // 碰撞到钻石\r\n        if(tag == 200 ){\r\n            let score = Number(StateManage.instance.getData(StateManage.KEY_SCORE)) + 50;\r\n            StateManage.instance.setData(StateManage.KEY_SCORE,score);\r\n            \r\n            let gem = Number(StateManage.instance.getData(StateManage.KEY_GEM)) + 1;\r\n            StateManage.instance.setData(StateManage.KEY_GEM,gem);\r\n            StateManage.instance.setData(StateManage.KEY_JEWEL_STATE,2);\r\n        }\r\n    }\r\n    // 加力动作\r\n    public strength(){\r\n        this.arm.getComponent(cc.RigidBody).applyLinearImpulse(new cc.Vec2(1000, 0), new cc.Vec2(0, 0), true);\r\n    }\r\n    // 检测\r\n    public crash(){\r\n        if(this.pancake[5] && StateManage.instance.getData(StateManage.KEY_ISOVER)==2){\r\n            let pans = this.pancake[5].getComponent(cc.RigidBody).getWorldCenter();\r\n            let pot = this.terrace.getComponent(cc.RigidBody).getWorldCenter();\r\n            if(pans.y < pot.y-50){\r\n                StateManage.instance.setData(StateManage.KEY_ISOVER,1);\r\n            }\r\n        }\r\n    }\r\n    // 开始触摸\r\n    private touchStartHandler(e:cc.Event):void {\r\n        this._isTouching = true;\r\n        this.initialize(2);\r\n        this.changeSkin();\r\n    }\r\n    // 触摸结束\r\n    private touchEndHandler(e:cc.Event):void {\r\n        this._isTouching = false;\r\n    }\r\n    // 改变皮肤 \r\n    private changeSkin(){\r\n        let resName = StateManage.instance.getData(StateManage.KEY_SKIN);\r\n        let res = new Json().skins;\r\n        let newSkin = {};\r\n        res.forEach(el =>{\r\n            if(el[\"name\"] == resName){\r\n                newSkin = el;\r\n            }\r\n        })\r\n        cc.log(resName,newSkin)\r\n\r\n        let currentBigArm = cc.url.raw(newSkin[\"bigArm\"]);\r\n        let currentLittleArm = cc.url.raw(newSkin[\"lowerArm\"]);\r\n        let currentPot = cc.url.raw(newSkin[\"hand\"]);\r\n\r\n        this.arm.getChildByName(\"arm1\").getComponent(cc.Sprite).spriteFrame.setTexture(currentBigArm);\r\n        this.node.getChildByName(\"hands\").getChildByName(\"littleArm\").getChildByName(\"arm2\").getComponent(cc.Sprite).spriteFrame.setTexture(currentLittleArm);\r\n        this.node.getChildByName(\"hands\").getChildByName(\"pot\").getChildByName(\"potImg\").getComponent(cc.Sprite).spriteFrame.setTexture(currentPot);\r\n        \r\n    }\r\n    // 数据值监控\r\n    private stateChangeHandler(e:cc.Event):void {\r\n        let key:string = StateManage.instance.lastChangedKey;\r\n        // 随机宝石\r\n        if (key == StateManage.KEY_JEWEL_STATE && StateManage.instance.jewel == 1) {\r\n            this.jewels.getComponent(Jewel).create();\r\n        }\r\n        if (key == StateManage.KEY_JEWEL_STATE && StateManage.instance.jewel == 2) {\r\n            this.jewels.active = false;\r\n        }\r\n        // 当前得分\r\n        if (key == StateManage.KEY_SCORE) {\r\n            this.score.getComponent(cc.Label).string = StateManage.instance.getData(StateManage.KEY_SCORE);\r\n        }\r\n        // 换皮肤\r\n        if (key == StateManage.KEY_SKIN) {\r\n            // this.changeSkin();\r\n        }\r\n        // 监控游戏是否结束 1 游戏结束展示页面 2 隐藏游戏结束页面\r\n        if (key == StateManage.KEY_ISOVER && StateManage.instance.isOver == 1) {\r\n            cc.find(\"Canvas/over\").getComponent('Over').show();\r\n        }else if (key == StateManage.KEY_ISOVER && StateManage.instance.isOver == 0){\r\n            this.initialize(3);\r\n        }\r\n    }\r\n    update (dt) {\r\n        if (this._isTouching) {\r\n           this.strength();\r\n        }\r\n       this.crash();\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        StateManage.instance.off(\"change\", this.stateChangeHandler);\r\n    }\r\n}\r\n"]}