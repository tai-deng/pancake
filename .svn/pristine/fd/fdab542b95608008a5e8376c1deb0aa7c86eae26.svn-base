{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\wechat/assets\\Script\\gamecore\\wechat\\WXRewardVideoAd.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\wechat","sourcesContent":["import GameManager from \"../managers/GameManager\";\r\nimport WXEventType from \"./WXEventType\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 微信激励视频广告\r\n * \r\n */\r\n@ccclass\r\nexport default class WXRewardVideoAd extends cc.EventTarget {\r\n\r\n    //视频广告对象\r\n    private static _ad:any;\r\n\r\n\r\n    private static _adID:string;\r\n\r\n    /**\r\n     * 设置广告id\r\n     */\r\n    static set adID(value:string) {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  set ad id  -\");\r\n        cc.info(value);\r\n\r\n        if (WXRewardVideoAd._adID != value) {\r\n            WXRewardVideoAd._adID = value;\r\n\r\n            WXRewardVideoAd.reset();\r\n        }\r\n    }\r\n\r\n\r\n    //广告是否已准备好\r\n    private static _isReady:boolean;\r\n\r\n    /**\r\n     * 广告是否已准备好\r\n     */\r\n    static get isReady():boolean {\r\n        return WXRewardVideoAd._isReady;\r\n    }\r\n\r\n\r\n    private static _isPlaying:boolean;\r\n\r\n    /**\r\n     * 是否正在播放视频广告\r\n     */\r\n    static get isPlaying():boolean {\r\n        return WXRewardVideoAd._isPlaying;\r\n    }\r\n\r\n\r\n    //记录当前背景音乐是否已静音\r\n    private static _originalBGMMuted:boolean;\r\n\r\n    /**\r\n     * 显示广告\r\n     */\r\n    static show():boolean {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  show  -\");\r\n        cc.info(\"WXRewardVideoAd._isReady\", WXRewardVideoAd._isReady);\r\n        cc.info(\"WXRewardVideoAd._isPlaying\", WXRewardVideoAd._isPlaying);\r\n\r\n        if (!WXRewardVideoAd._isReady) return false;\r\n        if (WXRewardVideoAd._isPlaying) return false;\r\n\r\n        //记录当前背景音乐是否已静音\r\n        WXRewardVideoAd._originalBGMMuted = GameManager.soundsManager.musicMuted;\r\n        \r\n        WXRewardVideoAd._ad.show();\r\n        WXRewardVideoAd._isPlaying = true;\r\n        \r\n        //静音背景音乐\r\n        GameManager.soundsManager.muteMusic();\r\n\r\n        return true;\r\n    }\r\n    /**\r\n     * 重置\r\n     */\r\n    static reset():void {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  reset  -\");\r\n\r\n        if (WXRewardVideoAd._ad) {\r\n            WXRewardVideoAd._ad.offLoad(WXRewardVideoAd.adLoadCallback);\r\n            WXRewardVideoAd._ad.offClose(WXRewardVideoAd.adCloseCallback);\r\n            WXRewardVideoAd._ad.offError(WXRewardVideoAd.adErrorCallback);\r\n            \r\n            WXRewardVideoAd._ad = null;\r\n        }\r\n\r\n        //重置参数\r\n        WXRewardVideoAd._isReady = false;\r\n        WXRewardVideoAd._isPlaying = false;\r\n\r\n        if (!WXRewardVideoAd._adID) return;\r\n\r\n        if (typeof wx == \"undefined\") return;\r\n\r\n        WXRewardVideoAd._ad = wx.createRewardedVideoAd({\r\n            adUnitId: WXRewardVideoAd._adID\r\n        });\r\n\r\n        //监听事件\r\n        WXRewardVideoAd._ad.onLoad(WXRewardVideoAd.adLoadCallback);\r\n        WXRewardVideoAd._ad.onClose(WXRewardVideoAd.adCloseCallback);\r\n        WXRewardVideoAd._ad.onError(WXRewardVideoAd.adErrorCallback);\r\n        WXRewardVideoAd._ad.load();\r\n    }\r\n\r\n\r\n    /**\r\n     * 广告加载完成回调\r\n     */\r\n    private static adLoadCallback():void {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  adLoadCallback  -\");\r\n\r\n        WXRewardVideoAd._isReady = true;\r\n        GameManager.eventManager.dispatchEventWith(WXEventType.REWARD_VIDEO_AD_READY);\r\n    }\r\n    \r\n    /**\r\n     * 广告关闭回调\r\n     */\r\n    private static adCloseCallback(res:object = null):void {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  adCloseCallback  -\");\r\n        cc.info(res);\r\n\r\n        //恢复背景音乐\r\n        if (!WXRewardVideoAd._originalBGMMuted) {\r\n            GameManager.soundsManager.unmuteMusic();\r\n            WXRewardVideoAd._originalBGMMuted = false;\r\n        }\r\n\r\n        WXRewardVideoAd._isPlaying = false;\r\n\r\n        // if (res) {\r\n        if (res && res[\"isEnded\"] == true) {\r\n            GameManager.eventManager.dispatchEventWith(WXEventType.REWARD_VIDEO_AD_COMPLETE);\r\n        } else {\r\n            GameManager.eventManager.dispatchEventWith(WXEventType.REWARD_VIDEO_AD_CLOSE);\r\n        }\r\n        // } else {\r\n        //     //兼容处理\r\n        //     GameManager.eventManager.dispatchEventWith(WXEventType.REWARD_VIDEO_AD_COMPLETE);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * 广告错误回调\r\n     */\r\n    private static adErrorCallback(res:object):void {\r\n        cc.info(\"----  微信视频广告 ----\");\r\n        cc.info(\"-  adErrorCallback  -\");\r\n        cc.info(res);\r\n\r\n        //恢复背景音乐\r\n        if (!WXRewardVideoAd._originalBGMMuted) {\r\n            GameManager.soundsManager.unmuteMusic();\r\n            WXRewardVideoAd._originalBGMMuted = false;\r\n        }\r\n\r\n        WXRewardVideoAd._isPlaying = false;\r\n\r\n        GameManager.eventManager.dispatchEventWith(WXEventType.REWARD_VIDEO_AD_ERROR);\r\n    }\r\n\r\n\r\n\r\n}\r\n"]}