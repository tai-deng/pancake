{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\wechat/assets\\Script\\gamecore\\wechat\\WXABannerAd.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\wechat","sourcesContent":["import WXBannerAd from \"./WXBannerAd\";\r\nimport WXEventType from \"./WXEventType\";\r\nimport GameManager from \"../managers/GameManager\";\r\nimport LocationValues from \"../LocationValues\";\r\nimport Utils from \"../managers/Utils\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 一个banner广告\r\n */\r\n\r\n@ccclass\r\nexport default class WXABannerAd extends cc.Component {\r\n\r\n    @property({\r\n        displayName:\"广告ID\"\r\n    })\r\n    adID:string = \"\";\r\n\r\n\r\n    @property({\r\n        displayName:\"位置\",\r\n        tooltip:\"BC:底部居中\\rTC:顶部居中\"\r\n    })\r\n    adLocation:string = \"BC\";\r\n\r\n    //广告最大宽度\r\n    @property({\r\n        displayName:\"最大宽度\"\r\n    })\r\n    maxWidth:number = 0;\r\n\r\n\r\n    private _wxBannerAd:WXBannerAd;\r\n\r\n    start () {\r\n        this.node.scale = 0;\r\n\r\n        if (!this.adLocation) this.adLocation = LocationValues.BOTTOM_CENTER\r\n        if (this.maxWidth <= 0) this.maxWidth = NaN;\r\n\r\n        this._wxBannerAd = new WXBannerAd(this.adID, this.adLocation, this.maxWidth);\r\n        \r\n        this._wxBannerAd.on(WXEventType.BANNER_AD_HIDE, this.adHideHandler, this);\r\n        this._wxBannerAd.on(WXEventType.BANNER_AD_SHOW, this.adShowHandler, this);\r\n        this._wxBannerAd.on(WXEventType.BANNER_AD_RESIZE, this.adResizeHandler, this);\r\n        this._wxBannerAd.show();\r\n    }\r\n\r\n\r\n    /**\r\n     * banner显示\r\n     * \r\n     * @param e \r\n     */\r\n    private adShowHandler(e:cc.Event):void {\r\n        this.node.active = true;\r\n    }\r\n\r\n    /**\r\n     * banner隐藏\r\n     * \r\n     * @param e \r\n     */\r\n    private adHideHandler(e:cc.Event):void {\r\n        this.node.active = false;\r\n    }\r\n    \r\n\r\n\r\n    private adResizeHandler(e:cc.Event):void {\r\n        let rect:cc.Rect = this._wxBannerAd.adRect;\r\n        rect = Utils.fromScreenRect(rect);\r\n\r\n        // cc.info(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@1\");\r\n        // cc.info(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@2\");\r\n        // cc.info(\"@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@3\");\r\n        // cc.info(rect.x, rect.y, rect.width, rect.height);\r\n\r\n        this.node.x = rect.x;\r\n        this.node.y = rect.y;\r\n        this.node.scaleX = rect.width / this.node.width;\r\n        this.node.scaleY = rect.height / this.node.height;\r\n\r\n        this.node.dispatchEvent(new cc.Event(WXEventType.BANNER_AD_RESIZE, false));\r\n\r\n        //尝试再次显示，以便兼容iphoneX\r\n        if (Utils.isIphoneX) this.fixIphoneXBug();\r\n    }\r\n    \r\n    \r\n    //尝试再次显示，以便兼容iphoneX\r\n    private static _isDoneFixed:boolean;\r\n    private fixIphoneXBug():void {\r\n        if (!WXABannerAd._isDoneFixed) {\r\n            WXABannerAd._isDoneFixed = true;\r\n\r\n            // this.schedule(function():void {\r\n            //     this._wxBannerAd.hide();\r\n            // }, 0.5, 1);\r\n\r\n            this.schedule(function():void {\r\n                this._wxBannerAd.show();\r\n            }, 1.5, 1);\r\n        }\r\n    }\r\n\r\n    // update (dt) {}\r\n\r\n    onDestroy () {\r\n        if (this._wxBannerAd) {\r\n            this._wxBannerAd.off(WXEventType.BANNER_AD_HIDE, this.adHideHandler, this);\r\n            this._wxBannerAd.off(WXEventType.BANNER_AD_SHOW, this.adShowHandler, this);\r\n            this._wxBannerAd.off(WXEventType.BANNER_AD_RESIZE, this.adResizeHandler, this);\r\n\r\n            // this._wxBannerAd.hide();\r\n            this._wxBannerAd.dispose();\r\n            this._wxBannerAd = null;\r\n        }\r\n            \r\n    }\r\n}\r\n"]}