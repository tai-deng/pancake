{"version":3,"sources":["../../../../../../assets/Script/gamecore/managers/assets/Script/gamecore/managers/EventManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/Script/gamecore/managers","sourcesContent":["import Command from \"./legs/Command\";\n\n// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n/**\n * 事件管理\n */\n@ccclass\nexport default class EventManager extends cc.Node {\n\n\n    //事件管理器\n    private _eventMap:object = {};\n    \n    /**\n     *\n     */\n    constructor() {\n        super();\n    }\n\n\n    /**\n     * 派发事件。自动生成cc.Event对象。\n     * \n     * @param eventName         事件名称\n     * @param data              携带数据\n     */\n    dispatchEventWith(eventName:string, data:any = null):void {\n        let evt:cc.Event = new cc.Event(eventName, false);\n        if (data) evt[\"data\"] = data;\n\n        this.dispatchEvent(evt);\n    }\n\n    // update (dt) {}\n\n    /**\n     * 绑定事件至命令。收到该事件时，会新建一个命令并执行。\n     * \n     * @param eventName                 事件名\n     * @param commandClass              命令类\n     */\n    mapEvent(eventName:string, commandClass):void {\n        if (this._eventMap[eventName] == undefined) {\n            this._eventMap[eventName] = [];\n            this.on(eventName, this.eventsHandler, this);\n        }\n\n        let commandClasses:Array<any> = this._eventMap[eventName];\n        if (commandClasses.indexOf(commandClass) == -1) {\n            commandClasses.push(commandClass);\n        }\n    }\n\n\n    /**\n     * 取消绑定事件\n     * \n     * @param eventName                     事件名\n     * @param commandClass                  命令类。如果传递null，则取消绑定所有命令\n     */\n    unmapEvent(eventName:string, commandClass = null):void {\n        let commandClasses:Array<any> = this._eventMap[eventName];\n        if (commandClasses != undefined) {\n            if (commandClass) {\n                //取消绑定该事件的指定命令\n                let index:number = commandClasses.indexOf(commandClass);\n                if (index >= 0) {\n                    commandClasses.splice(index, 1);\n                    if (commandClasses.length == 0) {\n                        delete this._eventMap[eventName];\n                        this.off(eventName, this.eventsHandler);\n                    }\n                }\n            } else {\n                //取消绑定所有该事件的命令\n                delete this._eventMap[eventName];\n                this.off(eventName, this.eventsHandler);\n            }\n        }\n    }\n\n    /**\n     * 解绑所有事件\n     */\n    unmapAllEvent():void {\n        for (let key in this._eventMap) {\n            this.unmapEvent(key);\n        }\n    }\n\n\n    /**\n     * 事件管理器\n     */\n    private eventsHandler(evt:cc.Event):void {\n        let eventName:string = evt.type;\n        let eventData:any = evt[\"data\"];\n\n        let commandClasses:Array<any> = this._eventMap[eventName];\n        if (commandClasses != undefined) {\n            let len:number = commandClasses.length;\n            for (let i:number = 0; i < len; i++) {\n                let command:Command = new commandClasses[i]();\n                command.event = evt;\n                command.data = eventData;\n                command.execute();\n            }\n        }\n\n    }\n\n}\n"]}