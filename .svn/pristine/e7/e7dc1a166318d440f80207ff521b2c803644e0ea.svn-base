{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\gameScene/assets\\Script\\gameScene\\GameOverPanelMain.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\gameScene","sourcesContent":["import GameManager from \"../gamecore/managers/GameManager\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\nimport WXRewardVideoAd from \"../gamecore/wechat/WXRewardVideoAd\";\r\nimport WXCore from \"../gamecore/wechat/WXCore\";\r\nimport WXEventType from \"../gamecore/wechat/WXEventType\";\r\nimport GameCoreEvent from \"../gamecore/GameCoreEvent\";\r\nimport XYJAPI from \"../gamecore/xiaoyaoji/XYJAPI\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n/**\r\n * 展示游戏结果\r\n */\r\n@ccclass\r\nexport default class GameOverPanelMain extends cc.Component {\r\n\r\n    //播放视频广告\r\n    @property(cc.Node)\r\n    playVideoAdBtn:cc.Node = null;\r\n\r\n    //再来一次\r\n    @property(cc.Node)\r\n    playAgainBtn:cc.Node = null;\r\n\r\n    //使用复活卡\r\n    @property(cc.Node)\r\n    userCardBtn:cc.Node = null;\r\n\r\n\r\n    //分数显示\r\n    @property(cc.Label)\r\n    scoreLabel:cc.Label = null;\r\n\r\n\r\n    start() {\r\n        let score:number = StateManage.instance.getData(StateManage.KEY_SCORE);\r\n        this.scoreLabel.string = \"\" + score;\r\n\r\n        this.playAgainBtn.on(cc.Node.EventType.TOUCH_END, this.playAgainBtnTapHandler, this);\r\n        this.playVideoAdBtn.on(cc.Node.EventType.TOUCH_END, this.playVideoAdBtnTapHandler, this);\r\n        this.userCardBtn.on(cc.Node.EventType.TOUCH_END, this.userCardBtnBtnTapHandler, this);\r\n\r\n        this.schedule(this.checkTime, 1, 10000);\r\n    }\r\n\r\n\r\n    private _passedTime:number = 0;\r\n\r\n    /**\r\n     * 检查时间\r\n     */\r\n    private checkTime():void {\r\n        if (WXRewardVideoAd.isPlaying) return;\r\n\r\n        this._passedTime++;\r\n        if (this._passedTime > 6) {\r\n            //进入小排行榜场景\r\n            cc.director.loadScene(\"indexScene\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击在来一次\r\n     * \r\n     * @param e \r\n     */\r\n    private playAgainBtnTapHandler(e:cc.Event):void {\r\n        GameManager.soundsManager.playTapSound();\r\n\r\n        cc.director.loadScene(\"gameScene\");\r\n    }\r\n\r\n    /**\r\n     * 点击播放视频\r\n     * \r\n     * @param e \r\n     */\r\n    private playVideoAdBtnTapHandler(e:cc.Event):void {\r\n        GameManager.soundsManager.playTapSound();\r\n\r\n        //检查是否广告是否可用\r\n        if (WXRewardVideoAd.isReady) {\r\n            WXCore.showToast(\"微信视频暂时无法展现!\");\r\n            return;\r\n        }\r\n\r\n        GameManager.eventManager.on(WXEventType.REWARD_VIDEO_AD_CLOSE, this.rewardVideoEventsHandler, this);\r\n        GameManager.eventManager.on(WXEventType.REWARD_VIDEO_AD_ERROR, this.rewardVideoEventsHandler, this);\r\n        GameManager.eventManager.on(WXEventType.REWARD_VIDEO_AD_COMPLETE, this.rewardVideoEventsHandler, this);\r\n    }\r\n\r\n\r\n    /**\r\n     * 视频广告事件控制\r\n     * \r\n     * @param e \r\n     */\r\n    private rewardVideoEventsHandler(e:cc.Event):void {\r\n        GameManager.eventManager.off(WXEventType.REWARD_VIDEO_AD_CLOSE, this.rewardVideoEventsHandler, this);\r\n        GameManager.eventManager.off(WXEventType.REWARD_VIDEO_AD_ERROR, this.rewardVideoEventsHandler, this);\r\n        GameManager.eventManager.off(WXEventType.REWARD_VIDEO_AD_COMPLETE, this.rewardVideoEventsHandler, this);\r\n\r\n        if (e.type == WXEventType.REWARD_VIDEO_AD_COMPLETE) {\r\n            //广告播放完成后，关闭面板，继续游戏\r\n            this.resurrect();\r\n        } else {\r\n            this._passedTime = 3;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 点击复活卡\r\n     * \r\n     * @param e \r\n     */\r\n    private userCardBtnBtnTapHandler(e:cc.Event):void {\r\n        GameManager.soundsManager.playTapSound();\r\n\r\n        let script:GameOverMain = this;\r\n\r\n        if (XYJAPI.reviveCount > 1) {\r\n            XYJAPI.useRevive(function(suc:boolean):void {\r\n                if (suc) {\r\n                    script.resurrect();\r\n                } else {\r\n                    this._passedTime = 3;\r\n                }\r\n            });\r\n        } else {\r\n            WXCore.showToast(\"无复活卡，赶紧去邀请好友吧~~~\");\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    /**\r\n     * 复活\r\n     */\r\n    private resurrect():void {\r\n        if (this._disposed) return;\r\n\r\n        this.node.dispatchEvent(new cc.Event(GameCoreEvent.COMMON_CLOSE, false));\r\n    }\r\n    \r\n\r\n    //是否已释放\r\n    private _disposed:boolean;\r\n    \r\n    onDestroy() {\r\n        this._disposed = true;\r\n\r\n        this.unschedule(this.checkTime);\r\n        // StateManage.instance.off(\"change\", this.stateChangeHandler);\r\n    }\r\n}\r\n"]}