{"version":3,"sources":["SoundsManager.ts"],"names":[],"mappings":";;;;;AAEA,oBAAoB;AACpB,iFAAiF;AACjF,yFAAyF;AACzF,mBAAmB;AACnB,2FAA2F;AAC3F,mGAAmG;AACnG,8BAA8B;AAC9B,2FAA2F;AAC3F,mGAAmG;AAE7F,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAG1C;IAA2C,iCAAc;IAoBrD;;OAEG;IACH;QAAA,YACI,iBAAO,SAYV;QAhCD,sFAAsF;QACtF,QAAQ;QACR,sFAAsF;QAEtF,YAAY;QACZ,sBAAgB,GAAU,IAAI,CAAC;QAG/B,MAAM;QACN,oBAAc,GAAU,IAAI,CAAC;QAC7B,sFAAsF;QAEtF,UAAU;QACF,qBAAe,GAAkB,EAAE,CAAC;QACpC,sBAAgB,GAAkB,EAAE,CAAC;QA+E7C,WAAW;QACH,iBAAW,GAAW,KAAK,CAAC;QAMpC,WAAW;QACH,iBAAW,GAAW,KAAK,CAAC;QA/EhC,QAAQ;QACR,IAAI,CAAC,GAAO,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,CAAC,CAAC;QACzE,IAAI,CAAC,IAAI,MAAM,EAAE;YACb,KAAI,CAAC,SAAS,EAAE,CAAC;SACpB;QAED,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,CAAC,CAAC;QACjE,IAAI,CAAC,IAAI,MAAM,EAAE;YACb,KAAI,CAAC,SAAS,EAAE,CAAC;SACpB;;IACL,CAAC;IAED,QAAQ;IACR,wCAAgB,GAAhB,UAAiB,SAAgB;QAC7B,IAAI,OAAO,CAAC;QACZ,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE;YACjC,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SACtE;QAED,IAAI,OAAO,IAAI,SAAS,EAAE;YACtB,gBAAgB;YAChB,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE;gBAClC,IAAI,aAAa,GAAU,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBACjF,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;aACvC;YAED,IAAI,EAAE,GAAU,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YACpE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC9B,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAEtC,IAAI,CAAC,cAAc,EAAE,CAAC;SACzB;IACL,CAAC;IAED,wBAAwB;IACxB,uCAAe,GAAf;QACI,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,IAAI,CAAC;YAAE,OAAO;QAE9C,IAAI,SAAS,GAAU,IAAI,CAAC,eAAe,CAAC,GAAG,EAAE,CAAC;QAClD,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;QAEhC,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,CAAC;QAE5B,SAAS,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;QACrC,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QAEjC,IAAI,CAAC,cAAc,EAAE,CAAC;IAC1B,CAAC;IAED,QAAQ;IACA,sCAAc,GAAtB;QACI,gBAAgB;QAChB,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,IAAI,CAAC;YAAE,OAAO;QAE9C,IAAI,aAAa,GAAU,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACjF,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,aAAa,CAAC,CAAC;QAC/C,IAAI,IAAI,CAAC,WAAW,EAAE;YAClB,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;YACpC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;SAC9C;aAAM;YACH,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YACrC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;SAC9C;IAGL,CAAC;IASD,sBAAI,qCAAU;aAAd;YACI,OAAO,IAAI,CAAC,WAAW,CAAC;QAC5B,CAAC;;;OAAA;IAKD,sBAAI,qCAAU;aAAd;YACI,OAAO,IAAI,CAAC,WAAW,CAAC;QAC5B,CAAC;;;OAAA;IAED,QAAQ;IACR,iCAAS,GAAT;QACI,IAAI,IAAI,CAAC,WAAW;YAAE,OAAO;QAE7B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,cAAc,EAAE,CAAC;QAEtB,MAAM;QACN,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IACnF,CAAC;IAGD,UAAU;IACV,mCAAW,GAAX;QACI,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;QAE9B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,cAAc,EAAE,CAAC;QAEtB,MAAM;QACN,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IACnF,CAAC;IAID,QAAQ;IACR,iCAAS,GAAT;QACI,IAAI,IAAI,CAAC,WAAW;YAAE,OAAO;QAE7B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAExB,MAAM;QACN,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IACnF,CAAC;IAGD,UAAU;IACV,mCAAW,GAAX;QACI,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO;QAE9B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QAEzB,MAAM;QACN,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;IACnF,CAAC;IAED,MAAM;IACN,iCAAS,GAAT,UAAU,SAAgB;QACtB,IAAI,CAAC,SAAS;YAAE,OAAO;QACvB,IAAI,IAAI,CAAC,WAAW;YAAE,OAAO;QAE7B,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;IACzD,CAAC;IAKD,MAAM;IACN,qCAAa,GAAb,UAAc,IAAiB;QAC3B,YAAY;QACZ,OAAO;QAEP,IAAI,CAAC,IAAI;YAAE,OAAO;QAClB,IAAI,IAAI,CAAC,WAAW;YAAE,OAAO;QAE7B,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC;SAC3E;QAED,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG,IAAI,CAAC;QAC9B,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;IAC7B,CAAC;IAID;;OAEG;IACH,oCAAY,GAAZ;QACI,IAAI,IAAI,CAAC,cAAc,EAAE;YACrB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;SACvC;IACL,CAAC;IAhMD,MAAM;IACC,uBAAS,GAAW,GAAG,CAAC;IAFd,aAAa;QADjC,OAAO;OACa,aAAa,CAkMjC;IAAD,oBAAC;CAlMD,AAkMC,CAlM0C,EAAE,CAAC,WAAW,GAkMxD;kBAlMoB,aAAa","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\managers","sourcesContent":["import GameManager from \"./GameManager\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SoundsManager extends cc.EventTarget {\r\n    //背景音乐\r\n    static bgSoundID: number = NaN;\r\n\r\n    //====================================================================================\r\n    //常用音效设置\r\n    //====================================================================================\r\n\r\n    //面板弹出声效素材地址\r\n    popUpSoundSource:string = null;\r\n    \r\n\r\n    //点击音效\r\n    tapSoundSource:string = null;\r\n    //====================================================================================\r\n\r\n    //场景背景音乐id\r\n    private senceBgSoundIDs: Array<number> = [];\r\n    private senceBgSoundURLs: Array<string> = [];\r\n\r\n    /**\r\n     *\r\n     */\r\n    constructor() {\r\n        super();\r\n\r\n        //读取本地数据\r\n        let v:any = cc.sys.localStorage.getItem(\"__l__soundsManager_soundMuted\");\r\n        if (v == \"true\") {\r\n            this.muteSound();\r\n        }\r\n\r\n        v = cc.sys.localStorage.getItem(\"__l__soundsManager_musicMuted\");\r\n        if (v == \"true\") {\r\n            this.muteMusic();\r\n        }\r\n    }\r\n\r\n    //推入场景音乐\r\n    pushSenceBgSound(sourceURL:string) {\r\n        let lastURL;\r\n        if (this.senceBgSoundURLs.length > 0) {\r\n             lastURL = this.senceBgSoundURLs[this.senceBgSoundURLs.length - 1];\r\n        }\r\n\r\n        if (lastURL != sourceURL) {\r\n            //如果当前有背景音乐，需要暂停\r\n            if (this.senceBgSoundURLs.length > 1) {\r\n                let lastBgSoundID:number = this.senceBgSoundIDs[this.senceBgSoundIDs.length - 1];\r\n                cc.audioEngine.pause(lastBgSoundID);\r\n            }\r\n\r\n            let id:number = cc.audioEngine.play(cc.url.raw(sourceURL), true, 1);\r\n            this.senceBgSoundIDs.push(id);\r\n            this.senceBgSoundURLs.push(sourceURL);\r\n\r\n            this.refreshBgSound();\r\n        }\r\n    }\r\n\r\n    //推出场景背景音乐（回到上一个场景的背景音乐）\r\n    popSenceBgSound() {\r\n        if (this.senceBgSoundURLs.length <= 1) return;\r\n\r\n        let bgSoundID:number = this.senceBgSoundIDs.pop();\r\n        cc.audioEngine.pause(bgSoundID);\r\n\r\n        this.senceBgSoundURLs.pop();\r\n\r\n        bgSoundID = this.senceBgSoundIDs[-1];\r\n        cc.audioEngine.resume(bgSoundID);\r\n\r\n        this.refreshBgSound();\r\n    }\r\n\r\n    //更新背景音乐\r\n    private refreshBgSound() {\r\n        //如果当前有背景音乐，需要暂停\r\n        if (this.senceBgSoundURLs.length == 0) return;\r\n        \r\n        let lastBgSoundID:number = this.senceBgSoundIDs[this.senceBgSoundIDs.length - 1];\r\n        console.log(\"@@@lastBgSoundID\", lastBgSoundID);\r\n        if (this._musicMuted) {\r\n            cc.audioEngine.pause(lastBgSoundID);\r\n            cc.audioEngine.setVolume(lastBgSoundID, 0);\r\n        } else {\r\n            cc.audioEngine.resume(lastBgSoundID);\r\n            cc.audioEngine.setVolume(lastBgSoundID, 1);\r\n        }\r\n        \r\n        \r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    //是否已静音背景音乐\r\n    private _musicMuted:boolean = false;\r\n\r\n    get musicMuted():boolean {\r\n        return this._musicMuted;\r\n    }\r\n\r\n    //是否已静音特效声音\r\n    private _soundMuted:boolean = false;\r\n\r\n    get soundMuted():boolean {\r\n        return this._soundMuted;\r\n    }\r\n\r\n    //静音背景音乐\r\n    muteMusic() {\r\n        if (this._musicMuted) return;\r\n\r\n        this._musicMuted = true;\r\n        this.refreshBgSound();\r\n        \r\n        //本地保存\r\n        cc.sys.localStorage.setItem(\"__l__soundsManager_musicMuted\", this._musicMuted);\r\n    }\r\n\r\n\r\n    //取消静音背景音乐\r\n    unmuteMusic() {\r\n        if (!this._musicMuted) return;\r\n\r\n        this._musicMuted = false;\r\n        this.refreshBgSound();\r\n\r\n        //本地保存\r\n        cc.sys.localStorage.setItem(\"__l__soundsManager_musicMuted\", this._musicMuted);\r\n    }\r\n\r\n\r\n\r\n    //静音特效音乐\r\n    muteSound() {\r\n        if (this._soundMuted) return;\r\n\r\n        this._soundMuted = true;\r\n\r\n        //本地保存\r\n        cc.sys.localStorage.setItem(\"__l__soundsManager_soundMuted\", this._soundMuted);\r\n    }\r\n\r\n\r\n    //取消静音特效音乐\r\n    unmuteSound() {\r\n        if (!this._soundMuted) return;\r\n\r\n        this._soundMuted = false;\r\n\r\n        //本地保存\r\n        cc.sys.localStorage.setItem(\"__l__soundsManager_soundMuted\", this._soundMuted);\r\n    }\r\n\r\n    //播放音效\r\n    playSound(sourceURL:string) {\r\n        if (!sourceURL) return;\r\n        if (this._soundMuted) return;\r\n\r\n        cc.audioEngine.play(cc.url.raw(sourceURL), false, 1);\r\n    }\r\n\r\n\r\n    private _audioSource:cc.AudioSource;\r\n\r\n    //播放音效\r\n    playSoundClip(clip:cc.AudioClip):void {\r\n        //TODO:DEBUG\r\n        return;\r\n\r\n        if (!clip) return;\r\n        if (this._soundMuted) return;\r\n\r\n        if (!this._audioSource) {\r\n            this._audioSource = cc.director.getScene().addComponent(cc.AudioSource);\r\n        }\r\n\r\n        this._audioSource.clip = clip;\r\n        this._audioSource.play();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 播放点击音效。前提是已经设置了 SoundsManager.tapSoundSource;\r\n     */\r\n    playTapSound():void {\r\n        if (this.tapSoundSource) {\r\n            this.playSound(this.tapSoundSource);\r\n        }\r\n    }\r\n}\r\n"]}