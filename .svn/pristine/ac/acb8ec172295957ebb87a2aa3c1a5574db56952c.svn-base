"use strict";
cc._RF.push(module, 'da20be3TNBHv554sl/Ynuvy', 'goods');
// Script/shopping/goods.ts

Object.defineProperty(exports, "__esModule", { value: true });
var StateManage_1 = require("../StateManage/StateManage");
var WXCore_1 = require("../gamecore/wechat/WXCore");
var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
var NewClass = /** @class */ (function (_super) {
    __extends(NewClass, _super);
    function NewClass() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        // 配置
        _this.deploy = null;
        _this.sumShop = null;
        _this.shopPrice = null;
        return _this;
        // onLoad () {
        // }
        // start () {
        // }
        // update (dt) {}
    }
    // item 按钮
    NewClass.prototype.itemBtn = function (event, data) {
        var item = event.target;
        if (this.deploy.isBuy == 1) {
            if (this.deploy.isUse == 1) {
                WXCore_1.default.showToast("皮肤已在使用中");
            }
            else if (this.deploy.isUse == 2) {
                cc.find("use", item).active = false;
                cc.find("inUse", item).active = true;
                this.ergodic();
                this.deploy.isUse = 1;
                WXCore_1.default.showToast("使用成功!");
                StateManage_1.default.instance.setData(StateManage_1.default.KEY_SKIN, this.deploy.skinsRes);
                cc.log(this.deploy.skinsRes, 2);
            }
        }
        else if (this.deploy.isBuy == 2) {
            if (this.deploy.waitBuy == 1) {
                cc.find("Canvas/toast").active = true;
                StateManage_1.default.instance.setData(StateManage_1.default.KEY_TRADE, this.deploy);
            }
            else if (this.deploy.waitBuy == 2) {
                WXCore_1.default.showToast("购买上一个皮肤后解锁");
            }
        }
    };
    // 遍历改变商品
    NewClass.prototype.ergodic = function () {
        this.sumShop = this.node.parent.children;
        this.sumShop.forEach(function (el) {
            if (el.getComponent("goods").deploy.isUse == 1) {
                cc.find("use", el).active = true;
                cc.find("inUse", el).active = false;
                el.getComponent("goods").deploy.isUse = 2;
            }
        });
    };
    // 取消购买
    NewClass.prototype.cancelBuy = function (event, customEventData) {
        cc.log("取消购买");
        cc.find("Canvas/toast").active = false;
        // cc.find("Canvas/toast/affirm").active = false;
        // cc.find("Canvas/toast/buyInfo").active = false;
    };
    // 确认购买
    NewClass.prototype.affirmBuy = function (event, customEventData) {
        var myGem = StateManage_1.default.instance.getData(StateManage_1.default.KEY_GEM);
        var trade = StateManage_1.default.instance.getData(StateManage_1.default.KEY_TRADE);
        var shopPrice = Number(trade.price);
        var showInfo = '';
        cc.log(shopPrice);
        if (myGem >= shopPrice) {
            var surplus = (myGem - shopPrice) <= 0 ? 0 : (myGem - shopPrice);
            StateManage_1.default.instance.setData(StateManage_1.default.KEY_GEM, surplus);
            showInfo = "购买成功，同时解锁了新购买项！";
            cc.log("购买成功", shopPrice);
            // 购买成功解锁并使用当前皮肤 让下一个皮肤待解锁 msk
            var sumShop = cc.find("Canvas").getComponent("shopping").container.children;
            var currentInd = 0;
            for (var i = 0; i < sumShop.length; ++i) {
                if (sumShop[i].getComponent("goods").deploy.isBuy == 1) {
                    cc.find("use", sumShop[i]).active = true;
                    cc.find("inUse", sumShop[i]).active = false;
                    sumShop[i].getComponent("goods").deploy.isUse = 2;
                }
                if (trade.id == sumShop[i].getComponent("goods").deploy.id) {
                    currentInd = i;
                    sumShop[i].getComponent("goods").deploy.isBuy = 1;
                    sumShop[i].getComponent("goods").deploy.isUse = 1;
                    sumShop[i].getComponent("goods").deploy.waitBuy = 1;
                    cc.find("use", sumShop[i]).active = false;
                    cc.find("inUse", sumShop[i]).active = true;
                    cc.find("price", sumShop[i]).active = false;
                    cc.find("prop", sumShop[i]).active = true;
                    cc.find("lock", sumShop[i]).active = false;
                    cc.find("msk", sumShop[i]).active = false;
                    StateManage_1.default.instance.setData(StateManage_1.default.KEY_SKIN, sumShop[i].getComponent("goods").deploy.skinsRes);
                    cc.log(sumShop[i].getComponent("goods").deploy.skinsRes, 3);
                }
            }
            var wait = sumShop[currentInd + 1];
            cc.find("use", wait).active = false;
            cc.find("inUse", wait).active = false;
            cc.find("price", wait).active = true;
            cc.find("prop", wait).active = true;
            cc.find("lock", wait).active = false;
            cc.find("msk", wait).active = true;
            wait.getComponent("goods").deploy.waitBuy = 1;
            var price = cc.find("price/money", wait).getComponent(cc.Label).string;
            if (myGem >= price) {
                wait.color = new cc.Color(17, 30, 131);
            }
            else {
                wait.color = new cc.Color(141, 22, 26);
            }
            if (wait.getComponent("goods").deploy.newPro == 1) {
                cc.find("newPro", wait).active = true;
            }
            else {
                cc.find("newPro", wait).active = false;
            }
        }
        else {
            showInfo = "宝石不足";
            cc.log("购买失败", shopPrice);
        }
        cc.find("Canvas/toast").active = false;
        WXCore_1.default.showToast(showInfo);
    };
    NewClass = __decorate([
        ccclass
    ], NewClass);
    return NewClass;
}(cc.Component));
exports.default = NewClass;

cc._RF.pop();