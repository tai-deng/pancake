{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\shopping/assets\\Script\\shopping\\Goods.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\shopping","sourcesContent":["import StateManage from \"../StateManage/StateManage\";\r\nimport WXCore from \"../gamecore/wechat/WXCore\";\r\nimport GameManager from \"../gamecore/managers/GameManager\";\r\nimport GameEventNames from \"../GameEventNames\";\r\nimport ShopMod from \"./ShopMod\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Goods extends cc.Component {\r\n    // 配置\r\n    // public deploy:object = null;\r\n    private sumShop: Array<cc.Node> = null;\r\n    private shopPrice: number = null;\r\n\r\n    @property(cc.Label)\r\n    price: cc.Label = null;\r\n    @property(cc.Node)\r\n    use: cc.Node;\r\n    @property(cc.Node)\r\n    useIn: cc.Node;\r\n    @property(cc.Node)\r\n    priceNode: cc.Node;\r\n    @property(cc.Node)\r\n    lock: cc.Node;\r\n    @property(cc.Node)\r\n    shopPic: cc.Node;\r\n    @property(cc.Node)\r\n    newPro: cc.Node\r\n\r\n    private _itemData: object;\r\n    get deploy(): object {\r\n        return this._itemData;\r\n    }\r\n    set deploy(v: object) {\r\n        if (this._itemData != v) {\r\n            this._itemData = v;\r\n            this.initialize();\r\n        }\r\n    }\r\n    // 渲染 UI\r\n    private initialize() {\r\n        let data = this.deploy;\r\n        for (const key in data) {\r\n            cc.log(this,\"`````````````````````\")\r\n\r\n            if (key == \"price\") {\r\n                this.price.getComponent(cc.Label).string = data[key];\r\n            }\r\n            // 买了 或者 使用了\r\n            if (data[\"isBuy\"]) {\r\n                this.shopPic.active = true;\r\n                this.newPro.active = false;\r\n                this.lock.active = false;\r\n                this.priceNode.active = false;\r\n                if (data[\"isUse\"]) {\r\n                    this.useIn.active = true;\r\n                    this.use.active = false;\r\n                } else {\r\n                    this.useIn.active = false;\r\n                    this.use.active = true;\r\n                }\r\n            } else if (data[\"waitBuy\"]) {\r\n                this.shopPic.active = true;\r\n                this.newPro.active = true;\r\n                this.lock.active = false;\r\n                this.priceNode.active = true;\r\n                this.useIn.active = false;\r\n                this.use.active = false;\r\n            } else {\r\n                this.shopPic.active = false;\r\n                this.newPro.active = false;\r\n                this.lock.active = true;\r\n                this.priceNode.active = false;\r\n                this.useIn.active = false;\r\n                this.use.active = false;\r\n            }\r\n        }\r\n    }\r\n    // 取消购买\r\n    public cancelBuy(event, customEventData) {\r\n        cc.log(\"取消购买\");\r\n    }\r\n    // 确认购买\r\n    public affirmBuy(trade:object) {\r\n        let myGem = StateManage.instance.getData(StateManage.KEY_GEM);\r\n        let shopPrice = Number(trade[\"price\"])\r\n        let showInfo = '';\r\n        \r\n        if (myGem >= shopPrice) {\r\n            cc.log(\"购买成功\", shopPrice,ShopMod.instance.isTab)\r\n            let surplus = myGem - shopPrice;\r\n            StateManage.instance.setData(StateManage.KEY_GEM, surplus);\r\n\r\n            showInfo = \"购买成功，同时解锁了新购买项！\";\r\n            let isTab = ShopMod.instance.isTab;\r\n            if(isTab){\r\n                ShopMod.instance.buyShopPot();\r\n            }else{\r\n                ShopMod.instance.buyShopCake();\r\n            }\r\n\r\n        } else {\r\n            showInfo = \"宝石不足\";\r\n            cc.log(\"购买失败\", shopPrice)\r\n        }\r\n        WXCore.showToast(showInfo)\r\n    }\r\n    // onLoad () {\r\n    // }\r\n\r\n    start() {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTap, this.node)\r\n    }\r\n    private onTap(ev: cc.Event) {\r\n        cc.log(ev)\r\n        let targetNode = ev.target.getComponent(\"Goods\");\r\n        targetNode.tapItem(targetNode.deploy);\r\n    }\r\n    // item 按钮\r\n    public tapItem(targetNode: object): void {\r\n        // 是否是已购买的    是否是使用中的\r\n        if (targetNode[\"isBuy\"]) {\r\n            if (targetNode[\"isUse\"]) {\r\n                WXCore.showToast(\"皮肤已在使用中\");\r\n            } else {\r\n                targetNode[\"isUse\"] = true;\r\n                WXCore.showToast(\"使用成功!\")\r\n                // StateManage.instance.setData(StateManage.KEY_SKIN,this.deploy.skinsRes);\r\n            }\r\n            // 是否是解锁的\r\n        } else {\r\n            if (targetNode[\"waitBuy\"]) {\r\n                let title: string = \"确认购买?\";\r\n                let script: Goods = this;\r\n                let callback: Function = function (label: string): void {\r\n                    cc.info(label)\r\n                    if (label == \"ok\") {\r\n                        script.affirmBuy(targetNode);\r\n                    }\r\n                    if (label == \"off\") { }\r\n                }\r\n                GameManager.eventManager.dispatchEventWith(GameEventNames.SHOW_ALERT, [title, callback])\r\n                // StateManage.instance.setData(StateManage.KEY_TRADE,this.deploy);\r\n\r\n            } else {\r\n                WXCore.showToast(\"购买上一个皮肤后解锁\")\r\n            }\r\n        }\r\n        // this.initialize();\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}