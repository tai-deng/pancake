{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\gameScene/assets\\Script\\gameScene\\GameSceneMain.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\gameScene","sourcesContent":["\r\nimport Config from \"../StateManage/StateManage\";\r\nimport GameManager from \"../gamecore/managers/GameManager\";\r\nimport GameOverCommand from \"../commands/GameOverCommand\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\nimport GameSystem from \"../GameSystem\";\r\nimport GameEventNames from \"../GameEventNames\";\r\nimport GameSceneEvents from \"./GameSceneEvents\";\r\nimport ActionMain from \"./ActionMain\";\r\nimport GameConfig from \"../GameConfig\";\r\nimport LevelInfoMain from \"./LevelInfoMain\";\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n\r\n/**\r\n * 游戏场景脚本\r\n * \r\n */\r\n@ccclass\r\nexport default class Game extends cc.Component {\r\n\r\n\r\n    @property(cc.Prefab)\r\n    actionPrefab:cc.Prefab = null;\r\n\r\n\r\n    //用户等级显示\r\n    @property(LevelInfoMain)\r\n    levelInfo:LevelInfoMain = null;\r\n\r\n    //分数显示\r\n    @property(cc.Label)\r\n    scoreLabel:cc.Label = null;\r\n\r\n    //分数显示\r\n    @property(cc.Node)\r\n    tapTipNode:cc.Node = null;\r\n\r\n\r\n    //手臂结构\r\n    private _actionNode:cc.Node;\r\n\r\n    //手臂结构脚本\r\n    private _action:ActionMain;\r\n    \r\n    onLoad () {\r\n        cc.info(\"【GameSceneMain init】\");\r\n\r\n        //初始化系统\r\n        GameSystem.init();\r\n\r\n        //初始化物理系统\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        cc.director.getPhysicsManager().debugDrawFlags = 1;\r\n    }\r\n\r\n    start () {\r\n        cc.info(this.node.name)\r\n        cc.info(\"【GameSceneMain start】\");\r\n\r\n        //监听事件\r\n        this.node.on(GameSceneEvents.LEVEL_CHANGED, this.levelChangedHandler, this);\r\n\r\n        this.initAction();\r\n        this.refreshLevel();\r\n    }\r\n\r\n\r\n    /**\r\n     * 初始化手臂结构\r\n     */\r\n    private initAction():void {\r\n        cc.info(\"【GameSceneMain initAction】\");\r\n\r\n        this._actionNode = cc.instantiate(this.actionPrefab);\r\n        this._action = this._actionNode.getComponent(ActionMain)\r\n        \r\n        this._actionNode.on(GameSceneEvents.GAME_START, this.actionEventsHandler, this);\r\n        this._actionNode.on(GameSceneEvents.SCORE_CHANGED, this.actionEventsHandler, this);\r\n        this._actionNode.on(GameSceneEvents.DIAMONDS_CHANGED, this.actionEventsHandler, this);\r\n        this._actionNode.on(GameSceneEvents.GAME_OVER, this.actionEventsHandler, this);\r\n        this.node.addChild(this._actionNode);\r\n\r\n    }\r\n\r\n\r\n    //记录上一次宝石的数量\r\n    private _lastDiamondCount:number = 0;\r\n\r\n    /**\r\n     * \r\n     * @param e \r\n     */\r\n    private actionEventsHandler(e:cc.Event):void {\r\n        let eType:string = e.type;\r\n\r\n        switch (eType) {\r\n            case GameSceneEvents.GAME_START:\r\n                //提示不可见\r\n                this.tapTipNode.active = false;\r\n                break;\r\n            case GameSceneEvents.SCORE_CHANGED:\r\n                let score:number = this._action.score;\r\n\r\n                //分数改变\r\n                StateManage.instance.setData(StateManage.KEY_SCORE, score);\r\n\r\n                //显示分数\r\n                this.scoreLabel.string = \"\" + score;\r\n\r\n                //改变位置\r\n                this.levelInfo.node.x = this.scoreLabel.node.x + this.scoreLabel.node.width / 2 + this.levelInfo.node.width / 2 + 5;\r\n\r\n                //刷新数据\r\n                this.levelInfo.score = score;\r\n\r\n                //刷新等级\r\n                this.refreshLevel();\r\n                break;\r\n            case GameSceneEvents.SCORE_CHANGED:\r\n                //宝石数量改变\r\n                let v:number = StateManage.instance.getData(StateManage.KEY_GEM);\r\n                v = v + this._action.diamondCount - this._lastDiamondCount;\r\n                StateManage.instance.setData(StateManage.KEY_GEM, v );\r\n                break;\r\n            case GameSceneEvents.GAME_OVER:\r\n                //游戏结束\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    //当前等级信息\r\n    private _currentLevelData:object = null;\r\n\r\n\r\n    /**\r\n     * 获取当前等级信息\r\n     */\r\n    public get currentLevelData():object {\r\n        return this._currentLevelData;\r\n    }\r\n\r\n\r\n    /**\r\n     * 刷新等级\r\n     */\r\n    private refreshLevel():void {\r\n        let data:object;\r\n\r\n        let score:number = this._action.score;\r\n        for (let i:number = 0; i < GameConfig.LEVELS.length; i++) {\r\n            let obj:object = GameConfig.LEVELS[i];\r\n            let scoreValues:[number, number] = obj[\"score\"];\r\n            if (score >= scoreValues[0] && score <= scoreValues[1]) {\r\n                data = obj;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (data && data != this._currentLevelData) {\r\n            this._currentLevelData = data;\r\n\r\n            //抛出事件\r\n            this.node.dispatchEvent(new cc.Event(GameSceneEvents.LEVEL_CHANGED, false));\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 等级变化回调\r\n     * \r\n     * @param e \r\n     */\r\n    private levelChangedHandler(e:cc.Event):void {\r\n\r\n        //设置数据\r\n        this.levelInfo.levelData = this._currentLevelData;\r\n    }\r\n\r\n    // update (dt) {\r\n    // }\r\n\r\n\r\n    onDestroy() {\r\n\r\n    }\r\n}\r\n"]}