{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\legs/assets\\Script\\gamecore\\legs\\Context.ts"],"names":[],"mappings":";;;;;AAAA,uDAAkD;AAG5C,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAE1C;;;GAGG;AAEH;IADA;QAGI,OAAO;QACC,cAAS,GAAU,EAAE,CAAC;IA6ElC,CAAC;IA3EG;;;;;OAKG;IACH,0BAAQ,GAAR,UAAS,SAAgB,EAAE,YAAY;QACnC,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,SAAS,EAAE;YACxC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;YAC/B,qBAAW,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;SACpE;QAED,IAAI,cAAc,GAAc,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,cAAc,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,EAAE;YAC5C,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SACrC;IACL,CAAC;IAGD;;;;;OAKG;IACH,4BAAU,GAAV,UAAW,SAAgB,EAAE,YAAmB;QAAnB,6BAAA,EAAA,mBAAmB;QAC5C,IAAI,cAAc,GAAc,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,cAAc,IAAI,SAAS,EAAE;YAC7B,IAAI,YAAY,EAAE;gBACd,cAAc;gBACd,IAAI,KAAK,GAAU,cAAc,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;gBACxD,IAAI,KAAK,IAAI,CAAC,EAAE;oBACZ,cAAc,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;oBAChC,IAAI,cAAc,CAAC,MAAM,IAAI,CAAC,EAAE;wBAC5B,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;wBACjC,qBAAW,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;qBAC/D;iBACJ;aACJ;iBAAM;gBACH,cAAc;gBACd,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;gBACjC,qBAAW,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;aAC/D;SACJ;IACL,CAAC;IAED;;OAEG;IACH,+BAAa,GAAb;QACI,KAAK,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,EAAE;YAC5B,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;SACxB;IACL,CAAC;IAGD;;OAEG;IACK,+BAAa,GAArB,UAAsB,GAAY;QAC9B,IAAI,SAAS,GAAU,GAAG,CAAC,IAAI,CAAC;QAChC,IAAI,SAAS,GAAO,GAAG,CAAC,MAAM,CAAC,CAAC;QAEhC,IAAI,cAAc,GAAc,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC1D,IAAI,cAAc,IAAI,SAAS,EAAE;YAC7B,IAAI,GAAG,GAAU,cAAc,CAAC,MAAM,CAAC;YACvC,KAAK,IAAI,CAAC,GAAU,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;gBACjC,IAAI,OAAO,GAAW,IAAI,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC;gBAC9C,OAAO,CAAC,KAAK,GAAG,GAAG,CAAC;gBACpB,OAAO,CAAC,IAAI,GAAG,SAAS,CAAC;gBACzB,OAAO,CAAC,OAAO,EAAE,CAAC;aACrB;SACJ;IAEL,CAAC;IA/EgB,OAAO;QAD3B,OAAO;OACa,OAAO,CAgF3B;IAAD,cAAC;CAhFD,AAgFC,IAAA;kBAhFoB,OAAO","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\legs","sourcesContent":["import GameManager from \"../managers/GameManager\";\r\nimport Command from \"./Command\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * legs框架上下文\r\n * \r\n */\r\n@ccclass\r\nexport default class Context {\r\n\r\n    //事件管理器\r\n    private _eventMap:object = {};\r\n\r\n    /**\r\n     * 绑定事件至命令。收到该事件时，会新建一个命令并执行。\r\n     * \r\n     * @param eventName                 事件名\r\n     * @param commandClass              命令类\r\n     */\r\n    mapEvent(eventName:string, commandClass):void {\r\n        if (this._eventMap[eventName] == undefined) {\r\n            this._eventMap[eventName] = [];\r\n            GameManager.eventManager.on(eventName, this.eventsHandler, this);\r\n        }\r\n\r\n        let commandClasses:Array<any> = this._eventMap[eventName];\r\n        if (commandClasses.indexOf(commandClass) == -1) {\r\n            commandClasses.push(commandClass);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 取消绑定事件\r\n     * \r\n     * @param eventName                     事件名\r\n     * @param commandClass                  命令类。如果传递null，则取消绑定所有命令\r\n     */\r\n    unmapEvent(eventName:string, commandClass = null):void {\r\n        let commandClasses:Array<any> = this._eventMap[eventName];\r\n        if (commandClasses != undefined) {\r\n            if (commandClass) {\r\n                //取消绑定该事件的指定命令\r\n                let index:number = commandClasses.indexOf(commandClass);\r\n                if (index >= 0) {\r\n                    commandClasses.splice(index, 1);\r\n                    if (commandClasses.length == 0) {\r\n                        delete this._eventMap[eventName];\r\n                        GameManager.eventManager.off(eventName, this.eventsHandler);\r\n                    }\r\n                }\r\n            } else {\r\n                //取消绑定所有该事件的命令\r\n                delete this._eventMap[eventName];\r\n                GameManager.eventManager.off(eventName, this.eventsHandler);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 解绑所有事件\r\n     */\r\n    unmapAllEvent():void {\r\n        for (let key in this._eventMap) {\r\n            this.unmapEvent(key);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 事件管理器\r\n     */\r\n    private eventsHandler(evt:cc.Event):void {\r\n        let eventName:string = evt.type;\r\n        let eventData:any = evt[\"data\"];\r\n\r\n        let commandClasses:Array<any> = this._eventMap[eventName];\r\n        if (commandClasses != undefined) {\r\n            let len:number = commandClasses.length;\r\n            for (let i:number = 0; i < len; i++) {\r\n                let command:Command = new commandClasses[i]();\r\n                command.event = evt;\r\n                command.data = eventData;\r\n                command.execute();\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n"]}