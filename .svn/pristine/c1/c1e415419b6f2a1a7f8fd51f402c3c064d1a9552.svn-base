import GameManager from "../gamecore/managers/GameManager";

const {ccclass, property} = cc._decorator;


/**
 * 启动场景
 */
@ccclass
export default class StartSence extends cc.Component {


    //声音控制按钮
    @property(cc.Node)
    soundBtn:cc.Node = null;

    //进入游戏场景按钮
    @property(cc.Node)
    toGameSenceBtn:cc.Node = null;

    onLoad () {
        //设置版本号
        GameManager.gameVersion = "1.0";

        //设置常用的音乐素材
        GameManager.soundsManager.tapSoundSource = "/resources/sounds/tap.mp3";
    }

    start () {
        //设置主场景背景音乐
        GameManager.soundsManager.pushSenceBgSound("/resources/sounds/startsence.mp3");
        
        //显示UI
        this.refreshSoundBtn();

        //事件监听
        this.soundBtn.on(cc.Node.EventType.TOUCH_END, this.soundBtnTapHandler, this);
        this.toGameSenceBtn.on(cc.Node.EventType.TOUCH_END, this.toGameSenceBtnTapHandler, this);

    }


    /**
     * 声音控制按钮点击
     * 
     * @param e 
     */
    private soundBtnTapHandler(e:cc.Event):void {
        //播放点击音效
        GameManager.soundsManager.playTapSound();

        if (GameManager.soundsManager.musicMuted) {
            GameManager.soundsManager.unmuteMusic();
        } else {
            GameManager.soundsManager.muteMusic();
        }

        this.refreshSoundBtn();
    }


    /**
     * 场景控制按钮点击
     * 
     * @param e 
     */
    private toGameSenceBtnTapHandler(e:cc.Event):void {
        //播放点击音效
        GameManager.soundsManager.playTapSound();

        //进入游戏场景
        cc.director.loadScene("GameSence");
    }

    /**
     * 刷新按钮显示
     */
    private refreshSoundBtn():void {
        let btnLabel:cc.Node = this.soundBtn.getChildByName("btnLabel");

        //检查是否已关闭背景音乐
        if (GameManager.soundsManager.musicMuted) {
            btnLabel.getComponent(cc.Label).string = "开启音乐";
        } else {
            btnLabel.getComponent(cc.Label).string = "关闭音乐";
        }
    }
}
