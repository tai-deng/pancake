{"version":3,"sources":["PopUpManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/Script/gamecore/managers","sourcesContent":["import { TweenLite } from \"../libs/TweenLite\";\nimport { Back } from \"../libs/EasePack\";\nimport GameManager from \"./GameManager\";\nimport GameCoreEvent from \"../GameCoreEvent\";\n\n// Learn TypeScript:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class PopUpManager extends cc.EventTarget {\n\n    private _popUpMap:object = {};\n\n    /**\n     * 创建背景\n     */\n    private createPopUpBg():cc.Node {\n        let winSize:cc.Size = cc.director.getWinSize();\n\n        let bg:cc.Node = new cc.Node();\n        bg.width = winSize.width;\n        bg.height = winSize.height;\n\n        var ctx:cc.Graphics = bg.addComponent(cc.Graphics);\n        ctx.fillColor = new cc.Color(0, 0, 0, 160);\n        // ctx.fillColor = cc.Color.RED;\n        ctx.lineWidth = 0;\n        ctx.fillRect(0, 0, winSize.width, winSize.height);\n        ctx.stroke();\n        // bg.color = cc.Color.BLACK;\n        // bg.opacity = 30;\n        bg.addComponent(cc.BlockInputEvents);\n\n        return bg;\n    }\n\n    /**\n     * 弹出内容\n     * \n     * @param node \n     */\n    addPopUp(node:cc.Node, modal:boolean = true):void {\n        let udid:string = node.uuid;\n\n        let winSize:cc.Size = cc.director.getWinSize();\n\n        if (modal) {\n            let bg:cc.Node = this.createPopUpBg();\n            bg.y = winSize.height / 2;\n            bg.x = winSize.width / 2;\n            cc.director.getScene().addChild(bg);\n\n            this._popUpMap[udid] = bg;\n        }\n\n        node.x = winSize.width / 2;\n        node.y = winSize.height / 2;\n        cc.director.getScene().addChild(node);\n\n        let toScale:number = Math.min(winSize.width * 0.75 / node.width, winSize.height * 0.8 / node.height);\n        node.scale = 0.5;\n\n        TweenLite.to(node, 0.5, {\"scale\":toScale, \"ease\":Back.easeOut});\n\n        //添加事件\n        node.on(GameCoreEvent.COMMON_CLOSE, this.nodeCloseEventHandler, this);\n\n        //播放音效\n        GameManager.soundsManager.playSound(GameManager.soundsManager.popUpSoundSource);\n    }\n\n\n    /**\n     * node关闭事件控制\n     * \n     * @param evt\n     */\n    private nodeCloseEventHandler(evt:cc.Event):void {\n        let node:cc.Node = evt.currentTarget as cc.Node;\n        this.removePopUp(node);\n    }\n    \n    \n    \n    /**\n     * 移除弹出\n     * \n     * @param node \n     */\n    removePopUp(node:cc.Node):void {\n        if (!node) return;\n\n        if (this._popUpMap[node.uuid]) {\n            node.off(GameCoreEvent.COMMON_CLOSE, this.nodeCloseEventHandler);\n\n            let bg:cc.Node = this._popUpMap[node.uuid];\n            delete this._popUpMap[node.uuid];\n\n            let obj:object = {\"scale\":node.scale, \"opacity\":node.opacity};\n            TweenLite.to(obj, 0.3, {\n                \"scale\":0.5, \n                \"opacity\":0, \n                \"onUpdate\":function(node:cc.Node, obj:object):void {\n                    if (node && node.parent) {\n                        node.scale = obj[\"scale\"];\n                        node.opacity = obj[\"opacity\"];\n                    }\n                },\n                \"onUpdateParams\":[node, obj],\n                \"onComplete\":function(node:cc.Node, bg:cc.Node):void {\n                    if (node && node.parent) {\n                        node.removeFromParent();\n                    }\n\n                    if (bg && bg.parent) {\n                        bg.removeFromParent();\n                    }\n                },\n                \"onCompleteParams\":[node, bg]\n            });\n        }\n\n    }\n\n\n}\n"]}