import RankCtrl from "./RankCtrl";
import WXCore from "./WXCore";

const {ccclass, property} = cc._decorator;

@ccclass
export default class Small extends cc.Component {

    @property(cc.Node)
    moreBtn:cc.Node = null;
    @property(cc.Node)
    content:cc.Node = null;
    @property(cc.Node)
    shareBtn:cc.Node = null;
    @property(cc.Node)
    againBtn:cc.Node = null;

    private _data:Array<object>;
    get data():Array<object>{
        return this._data;
    }
    set data(v:Array<object>){
        if(this._data != v){
            this._data = v;
            this.refreshUI();
        }
    }
    // onLoad () {}

    start () {
        if(!this._isOnLoadCalled) return;
        this.moreBtn.on(cc.Node.EventType.TOUCH_END,this.more,this.node);
        // this.shareBtn.on(cc.Node.EventType.TOUCH_END,this.share,this.node);
        this.againBtn.on(cc.Node.EventType.TOUCH_END,this.again,this.node);
        
        RankCtrl.instance.on("getsmallRank", this.getsmallRank, this);
        this.getsmallRank();
    }
    private getsmallRank(){
        this.data = RankCtrl.instance.getSmallRank();
        console.log("small",this.data)
    }

    private refreshUI(){
        let data = this.data;
        console.log(cc.director.getScene);
        this.content.removeAllChildren();
        cc.loader.loadRes("small", function(err, prefab){
            for(let i = 0;i < data.length; ++i){
                let item = cc.instantiate(prefab);
                item.getComponent("SmallItem").data = data[i];
                this.content.addChild(item);
            }
        }.bind(this));
    }
    // 查看更多
    private more(ev:Event):void{
        cc.director.loadScene("wholeRank");

        // cc.audioEngine.play(cc.url.raw("sounds/tap"), false, 1);

        // cc.audioEngine.play(cc.url.raw(sourceURL), false, 1);


        console.log("查看更多排名",ev)
    }
    // 分享
    private share(ev:Event):void{
        console.log("分享",ev)
        WXCore.setOnShareAppMessage("游戏分享",canvas.toTempFilePathSync({
            destWidth: 500,
            destHeight: 400
          }));
    }
    // 再来一局
    private again(ev:Event):void{
        console.log("again")
    }
    // update (dt) {}
}
