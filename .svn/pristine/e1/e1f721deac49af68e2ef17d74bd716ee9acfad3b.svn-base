{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Task/assets\\Script\\Task\\TaskMode.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Task","sourcesContent":["import StateManage from \"../StateManage/StateManage\";\r\nimport TaskJson from \"./TaskJson\";\r\nimport TaskProto from \"./TaskProto\";\r\nimport WXCore from \"../gamecore/wechat/WXCore\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TaskMode extends cc.Node {\r\n    constructor(){\r\n        super();\r\n        this.initTaskData();\r\n        StateManage.instance.on(\"change\", this.stateChangeHandler, this);\r\n    }\r\n\r\n    private static _instance:TaskMode = null;\r\n    public static get instance():TaskMode {\r\n        if(!TaskMode._instance) TaskMode._instance = new TaskMode();\r\n        return  TaskMode._instance;\r\n    }\r\n\r\n    private _storageTaskData:Array<object>=[];\r\n    private _taskDataJson:Array<object>= new TaskJson().task;\r\n    private _useData:Array<object>=[];\r\n    private date:Date = new Date();\r\n    public  flicker:boolean=false;\r\n    // 初始化渲染数据\r\n    private initTaskData(){\r\n        let data = StateManage.instance.getData(StateManage.KEY_TASKDATA);\r\n        if(JSON.stringify(data) == \"{}\"){\r\n            this.creation();\r\n        }else{\r\n            this._useData = data;\r\n        }\r\n    }\r\n    // 创建任务实例\r\n    private create(){\r\n        while (true){\r\n            let length = this._taskDataJson.length;\r\n            let ind = Math.floor(Math.random() * length);\r\n            ind = ind == length ? length - 1 : ind;\r\n            let item = this._taskDataJson[ind];\r\n            \r\n            let hasSame:boolean = false;\r\n            for(let i = 0;i < this._useData.length;++i){\r\n                if(this._useData[i][\"taskContent\"]['id'] == item['id']) {\r\n                    hasSame = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!hasSame) {\r\n                let task = new TaskProto();\r\n                task[\"taskContent\"] = item;\r\n                this.rezreo(item[\"value\"]);\r\n                this._useData.push(task);\r\n                return task;\r\n            }\r\n        }\r\n    }\r\n    // 任务数据归零\r\n    private rezreo (el:string){\r\n        switch(el){\r\n            case \"overturn\":\r\n            StateManage.instance.setData(\"overturn\",0);\r\n            break;\r\n            case \"tagem\":\r\n            StateManage.instance.setData(\"tagem\",0);\r\n            break;\r\n            case \"turn\":\r\n            StateManage.instance.setData(\"turn\",0);\r\n            break;\r\n            case \"tmturn\":\r\n            StateManage.instance.setData(\"tmturn\",0);\r\n            break;\r\n            case \"tagrade\":\r\n            StateManage.instance.setData(\"tagrade\",0);\r\n            break;\r\n            case \"resurgenceCar\":\r\n            StateManage.instance.setData(\"resurgenceCar\",0);\r\n            break;\r\n            case \"fdrelay\":\r\n            StateManage.instance.setData(\"fdrelay\",0);\r\n            break;\r\n            case \"crazyTap\":\r\n            StateManage.instance.setData(\"crazyTap\",0);\r\n            break;\r\n            case \"anyShare\":\r\n            StateManage.instance.setData(\"anyShare\",0);\r\n            break;\r\n            case \"ripeShare\":\r\n            StateManage.instance.setData(\"ripeShare\",0);\r\n            break;\r\n        }\r\n    }\r\n    // 创建任务数量\r\n    private creation(){\r\n        for(let i =0;i<3;i++){\r\n            this.create();\r\n        }\r\n    }\r\n    public handOut(){\r\n        return this._useData.concat();\r\n    }\r\n    // 功能1 看视频 刷新任务\r\n    public refreshTask(task:object){\r\n        let data = this._useData;\r\n        for(let i = 0;i < data.length;i++){\r\n            if(data[i][\"taskContent\"][\"id\"] == task[\"taskContent\"][\"id\"]){\r\n                this._useData[i]=this.create();\r\n                this._useData[i][\"isgaina\"] = false;\r\n                this._useData[i][\"isFinish\"] = false;\r\n                this._useData[i][\"tasknum\"] = 0;\r\n            }\r\n        }\r\n        this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n    }\r\n    // 功能2 开始游戏或分享\r\n    public watchVideo(task:object){\r\n        console.log(\"开始游戏或分享\")\r\n        this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n    }\r\n    // 功能3 领取奖励\r\n    public receiveAward(task:object){\r\n        let data = this._useData;\r\n        let awardName = task[\"taskContent\"][\"awardName\"];\r\n        let awardNum = task[\"taskContent\"][\"awardNum\"];\r\n        WXCore.showToast(`获得 宝石 ×${awardNum}`);\r\n        awardNum = awardNum + StateManage.instance.getData(awardName);\r\n        StateManage.instance.setData(awardName,awardNum);\r\n        for(let i =0;i<data.length;i++){\r\n            if(data[i][\"taskContent\"][\"id\"] == task[\"taskContent\"][\"id\"]){\r\n                this._useData[i][\"isgaina\"]=true;\r\n                this._useData[i][\"isFinish\"]=true;\r\n                this._useData[i][\"tasknum\"]=0;\r\n            }\r\n        }\r\n        this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n    }\r\n    // 功能4 完成任务\r\n    public finishTask(task:object){\r\n        let data = this._useData;\r\n        for(let i =0;i<data.length;i++){\r\n            if(data[i][\"taskContent\"][\"id\"] == task[\"taskContent\"][\"id\"]){\r\n                this._useData[i][\"isgaina\"]=false;\r\n                this._useData[i][\"isFinish\"]=true;\r\n                this._useData[i][\"tasknum\"]=0;\r\n                this._useData[i][\"tasknum\"]= this._useData[i][\"tasknum\"]-1;\r\n            }\r\n        }\r\n        cc.log(this._useData)\r\n        this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n    }\r\n    // 功能5 刷已经完成的任务\r\n    public refreshDoneTask(){\r\n        let data = this._useData;\r\n        for(let i = 0;i < data.length;i++){\r\n            if(data[i][\"isgaina\"] && data[i][\"isFinish\"]){\r\n                this._useData[i] = this.create();\r\n                this._useData[i][\"isgaina\"] = false;\r\n                this._useData[i][\"isFinish\"] = false;\r\n            }\r\n        }\r\n        this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n    }\r\n    // 功能6 定时更新任务\r\n    public setTimeDay(){\r\n        let nextDay = StateManage.instance.getData(StateManage.KEY_NEXTDAY);\r\n        let today = StateManage.instance.getData(StateManage.KEY_TODAY);\r\n\r\n        today = today?today:this.date.getTime();\r\n        // 没有目标时间的时候\r\n        if(nextDay == 0){\r\n            this.renewal();\r\n        }else if(today > nextDay){\r\n            this.newNextDay()\r\n        }\r\n    }\r\n    // 创建目标时间\r\n    public renewal(){\r\n        let time = this.date.getTime();\r\n        let newDate = new Date(time+86400000);\r\n        newDate.setHours(0,0,0);\r\n        let nextDay = newDate.getTime();\r\n        StateManage.instance.setData(StateManage.KEY_NEXTDAY,nextDay);\r\n    }\r\n    // 更新目标时间\r\n    public newNextDay(){\r\n        let time = this.date.getTime();\r\n        let newDate = new Date(time+86400000);\r\n        newDate.setHours(0,0,0);\r\n        let nextDay = newDate.getTime();\r\n        StateManage.instance.setData(StateManage.KEY_NEXTDAY,nextDay);\r\n        this.refreshDoneTask();\r\n    }\r\n    // 保存使用中的任务到 storage\r\n    public setStorageData(){}\r\n    \r\n    // 数据值监控\r\n    private stateChangeHandler(e:cc.Event):void {\r\n        let key:string = StateManage.instance.lastChangedKey;\r\n        for(let i =0;i < this._useData.length;i++){\r\n            if(key == this._useData[i][\"taskContent\"][\"value\"]){\r\n                let current = StateManage.instance.getData(StateManage.instance.lastChangedKey);\r\n                let want = this._useData[i][\"taskContent\"][\"goal\"];\r\n                if(current >= want){\r\n                    this._useData[i][\"isFinish\"] = true;\r\n                    this._useData[i][\"isgaina\"] = false;\r\n                    this.dispatchEvent(new cc.Event(\"useDataChanged\", false));\r\n                    this.flicker=true;\r\n                }else{\r\n                    this.flicker=false;\r\n                }\r\n                this.dispatchEvent(new cc.Event(\"bubbleChanged\",false));\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}