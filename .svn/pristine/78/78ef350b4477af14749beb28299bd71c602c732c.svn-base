{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Task/assets\\Script\\Task\\TaskItem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Task","sourcesContent":["import WXCore from \"../gamecore/wechat/WXCore\";\r\nimport GameManager from \"../gamecore/managers/GameManager\";\r\nimport GameEventNames from \"../GameEventNames\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TaskItem extends cc.Component {\r\n\r\n    @property(cc.Label)\r\n    taskName:cc.Label = null;\r\n    @property(cc.Label)\r\n    taskDetails:cc.Label = null;\r\n    @property(cc.Label)\r\n    plan:cc.Label = null;\r\n    @property(cc.Node)\r\n    progress:cc.Node = null;\r\n    public itemTatus:object = {};\r\n    public _plan:number;\r\n\r\n\r\n    //已领取按钮\r\n    @property(cc.SpriteFrame)\r\n    rewardedBtnSF:cc.SpriteFrame = null;\r\n    //未领取按钮\r\n    @property(cc.SpriteFrame)\r\n    rewardedBtnNO:cc.SpriteFrame = null;\r\n    // 当前item索引\r\n    private _itemIndex:number;\r\n    // 刷新任务的次数\r\n    private _taskNum:number;\r\n    // 是否领取奖励\r\n    private _isGain:number;\r\n\r\n    onLoad () {}\r\n    start () {}\r\n\r\n    private _itemData:object;\r\n    get itemData():object {\r\n        return this._itemData;\r\n    }\r\n    set itemData(v:object) {\r\n        if (this._itemData != v) {\r\n            this._itemData = v;\r\n            this.init();\r\n        }\r\n    }\r\n    // 初始化逻辑层\r\n    private init(){\r\n        if (!this._isOnLoadCalled) return;\r\n        if (!this._itemData) return;\r\n        let data = this.itemData;\r\n        let planValue = StateManage.instance.getData(data[\"value\"]);\r\n        this._itemIndex = this.node[\"itemIndex\"];\r\n        this._taskNum = StateManage.instance.getData(\"tasknum\"+this._itemIndex);\r\n        this._isGain = StateManage.instance.getData(\"isgaina\"+this._itemIndex);\r\n\r\n        if(planValue >= data[\"goal\"]){\r\n            this._plan = data[\"goal\"];\r\n            this.itemTatus[\"finish\"] =1;\r\n\r\n            if(this._isGain == 1){\r\n                this.itemTatus[\"gain\"] = 1;\r\n\r\n            }else if(this._isGain == 2){\r\n                this.itemTatus[\"gain\"] = 2;\r\n\r\n            }else if(this._isGain == 0){\r\n                StateManage.instance.setData(\"isgaina\"+this._itemIndex,2);\r\n            }\r\n        }else{\r\n            this._plan = planValue;\r\n            this.itemTatus[\"finish\"] =2;\r\n        }\r\n        this.refreshUI();\r\n    }\r\n    // 更新UI\r\n    private refreshUI():void{\r\n        let data = this.itemData;\r\n        this.taskName.string = data[\"title\"];\r\n        this.taskDetails.string = \"任务奖励：宝石×\"+data[\"awardNum\"];\r\n        if(this.itemTatus[\"finish\"] ==1){\r\n            \r\n            cc.find(\"right/bottom/playbar\",this.node).active = false;\r\n\r\n            if(this.itemTatus[\"gain\"] ==1){\r\n                cc.find(\"right/bottom/rewarded\",this.node).active = true;\r\n            }\r\n\r\n            if(this.itemTatus[\"gain\"] ==2){\r\n                cc.find(\"right/bottom/affirm\",this.node).active = true;\r\n            }\r\n            cc.find(\"refresh\",this.node).active = false;\r\n        }\r\n        if(this.itemTatus[\"finish\"] ==2){\r\n            cc.find(\"right/bottom/rewarded\",this.node).active = false;\r\n            cc.find(\"right/bottom/affirm\",this.node).active = false;\r\n            cc.find(\"right/bottom/playbar\",this.node).active = true;\r\n            if(this._taskNum > 0){\r\n                cc.find(\"refresh\",this.node).active = true;\r\n            }else{\r\n                cc.find(\"refresh\",this.node).active = false;\r\n            }\r\n        }\r\n        this.plan.string = this._plan + \"/\" + data[\"goal\"];\r\n        this.progress.width = (116/data[\"goal\"]) * this._plan;\r\n        \r\n    }\r\n    /**\r\n     * 完成任务获取指定奖励\r\n     * 任务状态 1 完成了    2 未完成    finish\r\n     * 完成了   1 已领取    2 未领取    gain\r\n     */\r\n    public affirmBtn(event:cc.Event):void{\r\n        let script:TaskItem = this;\r\n        if(this.itemTatus[\"gain\"] == 2){\r\n            let temp = StateManage.instance.getData(this.itemData[\"awardName\"]) + this.itemData[\"awardNum\"];\r\n            StateManage.instance.setData(this.itemData[\"awardName\"],temp);\r\n            WXCore.showToast(\"完成任务获取\"+this.itemData[\"awardNum\"]+\"钻石奖励!\");\r\n        }\r\n        this.itemTatus[\"gain\"] = 1;\r\n        StateManage.instance.setData(\"isgaina\"+this._itemIndex,1);\r\n        this.refreshUI();\r\n    }\r\n    // 开始游戏或者分享\r\n    public playbarBtn(event:cc.Event):void{\r\n        cc.log(\"开始游戏或者分享\");\r\n    }\r\n    // 刷新任务\r\n    public refresh(){\r\n        let title:string = \"\";\r\n        let script:TaskItem = this;\r\n        let callback:Function = function(){};\r\n        cc.log(this._taskNum)\r\n        if(this._taskNum > 0){\r\n            title = \"要观看一次广告来替换这个任务吗？\";\r\n            callback = function(label:string):void {\r\n                cc.info(label)\r\n                if (label == \"ok\") {\r\n                    script.affirm();\r\n                }\r\n                if(label == \"off\"){}\r\n            }\r\n            GameManager.eventManager.dispatchEventWith(GameEventNames.SHOW_ALERT, [title, callback])\r\n        }\r\n    }\r\n    // 确认更新\r\n    public affirm(){\r\n        this.node.dispatchEvent(new cc.Event(\"getData\", false))\r\n        StateManage.instance.setData(\"tasknum\"+this._itemIndex,this._taskNum-1)\r\n        StateManage.instance.setData(\"isgaina\"+this._itemIndex,2);\r\n        this.init();\r\n    }\r\n    // update (dt) {}\r\n\r\n}\r\n"]}