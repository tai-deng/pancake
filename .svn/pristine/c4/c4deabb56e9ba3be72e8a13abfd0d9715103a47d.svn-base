import StateManage from "../StateManage/StateManage";
import GameManager from "../gamecore/managers/GameManager";
import GameEventNames from "../GameEventNames";

// Learn TypeScript:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html
// Learn Attribute:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html
//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html

const {ccclass, property} = cc._decorator;

/**
 * 游戏等级信息
 */
@ccclass
export default class LevelInfoMain extends cc.Component {

    //进度条
    @property(cc.Sprite)
    progressSprite:cc.Sprite = null;

    //等级名称
    @property(cc.Label)
    levelName:cc.Label = null;

    //等级详情
    @property(cc.Label)
    levelDetail:cc.Label = null;

    // LIFE-CYCLE CALLBACKS:

    // onLoad () {}

    start () {
        cc.info("【LevelInfoMain start】");

        this.node.on(cc.Node.EventType.TOUCH_END, this.tapHandler, this);
    }



    private tapHandler(e:cc.Event):void {
        //音效
        GameManager.soundsManager.playTapSound();
        
        GameManager.eventManager.dispatchEventWith(GameEventNames.SHOW_LEVEL_DETAIL, this._levelData);
    }


    private _score:number = 0;

    /**
     * 设置分数
     */
    public set score(value:number) {
        if (this._score == value) return;
        this._score = value;

        this.refreshUI();
    }

    private _levelData:object;

    /**
     * 设置等级信息
     */
    public set levelData(value:object) {
        if (!value) return;

        if (this._levelData == value) return;
        this._levelData = value;

        this.refreshUI();
    }


    /**
     * 刷新UI
     */
    private refreshUI():void {
        if (!this._levelData) {
            return;
        }

        cc.info(JSON.stringify(this._levelData));

        this.levelName.string = "等级 " + this._levelData["level"];
        
        let scoreValues:[number, number] = this._levelData["score"];
        // this.levelDetail.string = "" + (scoreValues[1] - this._score) + "分后升级";
        this.levelDetail.string = this._levelData["desc"];

        //显示进度
        this.progressSprite.fillRange = (this._score - scoreValues[0]) / (scoreValues[1] - scoreValues[0]);
    }



    // update (dt) {}


    onDestroy() {

    }
}
