{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Task/assets\\Script\\Task\\Task.ts"],"names":[],"mappings":";;;;;AAAA,qCAAgC;AAChC,0DAAqD;AACrD,uCAAkC;AAE5B,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAG1C;IAAkC,wBAAY;IAD9C;QAAA,qEA6KC;QA3KW,SAAG,GAAU,CAAC,CAAC;QAEvB,OAAO;QAEP,WAAK,GAAkB,EAAE,CAAC;QAC1B,OAAO;QACC,WAAK,GAAiB,EAAE,CAAC;QACjC,OAAO;QACC,iBAAW,GAAiB,EAAE,CAAC;QAC/B,UAAI,GAAQ,IAAI,IAAI,EAAE,CAAC;;IAkKnC,CAAC;IAhKG,qBAAM,GAAN;QACI,IAAI,CAAC,KAAK,GAAG,IAAI,cAAI,EAAE,CAAC,KAAK,CAAC;IAClC,CAAC;IAED,oBAAK,GAAL;QACI,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAED;;;OAGG;IACI,mBAAI,GAAX;QACI,IAAG,CAAC,IAAI,CAAC,eAAe;YAAC,OAAO;QAChC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAS,EAAE,EAAC,GAAG;YAC9B,IAAI,IAAI,GAAW,EAAa,CAAC;YACjC,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;YAC3C,IAAI,CAAC,IAAI,CAAC,EAAC,WAAW,EAAC,GAAG,EAAC,CAAC,CAAC;YAC7B,IAAI,KAAK,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,GAAC,GAAG,CAAC,CAAC;YACrD,IAAI,SAAS,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,YAAY,CAAC,CAAC;YACvE,IAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,IAAI,EAAC;gBAC7B,IAAI,CAAC,MAAM,CAAC,EAAE,EAAC,GAAG,CAAC,CAAC;aACvB;iBAAI;gBACD,EAAE,CAAC,YAAY,CAAC,kBAAQ,CAAC,CAAC,QAAQ,GAAG,KAAK,CAAC;gBAC3C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;gBAC5B,IAAG,SAAS,IAAI,CAAC,EAAC;oBACd,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,EAAC,CAAC,CAAC,CAAC;oBAC9C,IAAI,OAAO,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,CAAC,CAAC;oBAC1D,IAAG,OAAO,IAAI,CAAC,EAAC;wBACZ,IAAI,CAAC,MAAM,CAAC,EAAE,EAAC,GAAG,CAAC,CAAC;qBACvB;iBACJ;aACJ;YACD,IAAI,OAAO,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,CAAC,CAAC;QAC9D,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA;IACjB,CAAC;IACD,aAAa;IACL,qBAAM,GAAd,UAAe,IAAY,EAAC,KAAY;QACpC,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,GAAC,KAAK,EAAC,CAAC,CAAC,CAAC;QAChD,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;QAChC,IAAI,CAAC,YAAY,CAAC,kBAAQ,CAAC,CAAC,QAAQ,GAAG,OAAO,CAAC;QAC/C,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,GAAC,KAAK,EAAC,OAAO,CAAC,CAAC;IACvD,CAAC;IACD,SAAS;IACD,0BAAW,GAAnB,UAAoB,CAAU;QAC1B,IAAI,IAAI,GAAW,CAAC,CAAC,aAAwB,CAAC;QAC9C,IAAI,QAAQ,GAAY,IAAI,CAAC,YAAY,CAAC,kBAAQ,CAAC,CAAC;QACpD,IAAI,KAAK,GAAI,IAAI,CAAC,YAAY,CAAC,kBAAQ,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACxD,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,EAAE;YACvB,IAAG,EAAE,CAAC,IAAI,CAAC,IAAI,KAAK,EAAC;gBACjB,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;aAChB;QACL,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,WAAW,GAAG,GAAG,CAAC;QACvB,QAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,EAAE,CAAC;IAE1C,CAAC;IACD,SAAS;IACF,qBAAM,GAAb,UAAe,EAAS;QACpB,QAAO,EAAE,EAAC;YACN,KAAK,UAAU;gBACf,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM;YACN,KAAK,OAAO;gBACZ,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,EAAC,CAAC,CAAC,CAAC;gBACxC,MAAM;YACN,KAAK,MAAM;gBACX,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAC,CAAC,CAAC,CAAC;gBACvC,MAAM;YACN,KAAK,QAAQ;gBACb,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAC,CAAC,CAAC,CAAC;gBACzC,MAAM;YACN,KAAK,SAAS;gBACd,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,EAAC,CAAC,CAAC,CAAC;gBAC1C,MAAM;YACN,KAAK,eAAe;gBACpB,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe,EAAC,CAAC,CAAC,CAAC;gBAChD,MAAM;YACN,KAAK,SAAS;gBACd,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,SAAS,EAAC,CAAC,CAAC,CAAC;gBAC1C,MAAM;YACN,KAAK,UAAU;gBACf,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM;YACN,KAAK,UAAU;gBACf,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAU,EAAC,CAAC,CAAC,CAAC;gBAC3C,MAAM;YACN,KAAK,WAAW;gBAChB,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,WAAW,EAAC,CAAC,CAAC,CAAC;gBAC5C,MAAM;SACT;IACL,CAAC;IACD,OAAO;IACA,yBAAU,GAAjB;QACI,IAAI,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC;QAC3B,OAAO,IAAI,EAAC;YACR,IAAI,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;YAC/B,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC;YAC7C,GAAG,GAAG,GAAG,IAAI,MAAM,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;YACvC,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC5B,IAAI,OAAO,GAAW,KAAK,CAAC;YAE5B,KAAI,IAAI,CAAC,GAAG,CAAC,EAAC,CAAC,GAAG,GAAG,CAAC,MAAM,EAAC,EAAE,CAAC,EAAC;gBAC7B,IAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE;oBAC5B,OAAO,GAAG,IAAI,CAAC;oBACf,MAAM;iBACT;aACJ;YACD,IAAI,CAAC,OAAO,EAAE;gBACV,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;gBAC5B,OAAO,KAAK,CAAC;aAChB;SACJ;IACL,CAAC;IACD;;;;;;OAMG;IACI,yBAAU,GAAjB;QACI,IAAI,OAAO,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,WAAW,CAAC,CAAC;QAEpE,IAAI,KAAK,GAAG,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,SAAS,CAAC,CAAC;QAChE,KAAK,GAAG,KAAK,CAAA,CAAC,CAAA,KAAK,CAAA,CAAC,CAAA,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAExC,IAAG,OAAO,IAAI,CAAC,EAAC;YACZ,IAAI,CAAC,OAAO,EAAE,CAAC;SAClB;aAAK,IAAG,KAAK,GAAG,OAAO,EAAC;YACrB,IAAI,CAAC,UAAU,EAAE,CAAA;SACpB;IACL,CAAC;IACM,sBAAO,GAAd;QACI,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAI,OAAO,GAAG,IAAI,IAAI,CAAC,IAAI,GAAC,QAAQ,CAAC,CAAC;QACtC,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QACxB,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QAChC,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,WAAW,EAAC,OAAO,CAAC,CAAC;IAClE,CAAC;IACD;;OAEG;IACI,yBAAU,GAAjB;QACI,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAI,OAAO,GAAG,IAAI,IAAI,CAAC,IAAI,GAAC,QAAQ,CAAC,CAAC;QACtC,OAAO,CAAC,QAAQ,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QACxB,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QAChC,qBAAW,CAAC,QAAQ,CAAC,OAAO,CAAC,qBAAW,CAAC,WAAW,EAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IACD,qBAAM,GAAN,UAAQ,EAAE;QACN,IAAI,CAAC,GAAG,IAAI,EAAE,CAAC;QACf,IAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAC;YACzB,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC;SAChB;IACL,CAAC;IAtKD;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;uCACM;IALT,IAAI;QADxB,OAAO;OACa,IAAI,CA4KxB;IAAD,WAAC;CA5KD,AA4KC,CA5KiC,EAAE,CAAC,SAAS,GA4K7C;kBA5KoB,IAAI","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Task","sourcesContent":["import Json from \"../Json/Json\";\r\nimport StateManage from \"../StateManage/StateManage\";\r\nimport TaskItem from \"./TaskItem\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Task extends cc.Component {\r\n    private sec:number = 0;\r\n    \r\n    // 任务节点\r\n    @property([cc.Node])\r\n    items:Array<cc.Node> = [];\r\n    // 所有任务\r\n    private tasks:Array<object> = [];\r\n    // 当前任务\r\n    private currentTask:Array<object> = [];\r\n    private date:Date = new Date();\r\n\r\n    onLoad () {\r\n        this.tasks = new Json().tasks;\r\n    }\r\n\r\n    start () {\r\n        this.init();\r\n    }\r\n\r\n    /**\r\n     * 初始化任务   \r\n     * 1.如果当前时间过了 0 点增加任务次数 1;\r\n     */\r\n    public init(){\r\n        if(!this._isOnLoadCalled)return;\r\n        this.items.forEach(function(el,ind){\r\n            let item:cc.Node = el as cc.Node;\r\n            item.on(\"getData\", this.itemGetData, this);\r\n            item.attr({\"itemIndex\":ind});\r\n            let _task = StateManage.instance.getData(\"task\"+ind);\r\n            let _midnight = StateManage.instance.getData(StateManage.KEY_MIDNIGHT);\r\n            if(JSON.stringify(_task) == \"{}\"){\r\n                this.create(el,ind);\r\n            }else{\r\n                el.getComponent(TaskItem).itemData = _task;\r\n                this.currentTask.push(_task)\r\n                if(_midnight == 1){\r\n                    StateManage.instance.setData(\"tasknum\"+ind,1);\r\n                    let _isGain = StateManage.instance.getData(\"isgaina\"+ind);\r\n                    if(_isGain == 1){\r\n                        this.create(el,ind);\r\n                    }\r\n                }\r\n            }\r\n            let taskNum = StateManage.instance.getData(\"tasknum\"+ind);\r\n        }.bind(this))\r\n    }\r\n    // 初始化一个完整的任务\r\n    private create(node:cc.Node,index:number){\r\n        StateManage.instance.setData(\"tasknum\"+index,1);\r\n        let newTask = this.randomTask();\r\n        node.getComponent(TaskItem).itemData = newTask;\r\n        StateManage.instance.setData(\"task\"+index,newTask);\r\n    }\r\n    // 确认刷新任务\r\n    private itemGetData(e:cc.Event):void {\r\n        let item:cc.Node = e.currentTarget as cc.Node;\r\n        let taskItem:TaskItem = item.getComponent(TaskItem);\r\n        let oldId =  item.getComponent(TaskItem).itemData[\"id\"];\r\n        let arr = [];\r\n        this.currentTask.forEach(el => {\r\n            if(el[\"id\"] != oldId){\r\n                arr.push(el);\r\n            }\r\n        });\r\n        this.currentTask = arr;\r\n        taskItem.itemData = this.randomTask();\r\n        \r\n    }\r\n    // 任务数据归零\r\n    public rezreo (el:string){\r\n        switch(el){\r\n            case \"overturn\":\r\n            StateManage.instance.setData(\"overturn\",0);\r\n            break;\r\n            case \"tagem\":\r\n            StateManage.instance.setData(\"tagem\",0);\r\n            break;\r\n            case \"turn\":\r\n            StateManage.instance.setData(\"turn\",0);\r\n            break;\r\n            case \"tmturn\":\r\n            StateManage.instance.setData(\"tmturn\",0);\r\n            break;\r\n            case \"tagrade\":\r\n            StateManage.instance.setData(\"tagrade\",0);\r\n            break;\r\n            case \"resurgenceCar\":\r\n            StateManage.instance.setData(\"resurgenceCar\",0);\r\n            break;\r\n            case \"fdrelay\":\r\n            StateManage.instance.setData(\"fdrelay\",0);\r\n            break;\r\n            case \"crazyTap\":\r\n            StateManage.instance.setData(\"crazyTap\",0);\r\n            break;\r\n            case \"anyShare\":\r\n            StateManage.instance.setData(\"anyShare\",0);\r\n            break;\r\n            case \"ripeShare\":\r\n            StateManage.instance.setData(\"ripeShare\",0);\r\n            break;\r\n        }\r\n    }\r\n    // 随机任务\r\n    public randomTask(){\r\n        let arr = this.currentTask;\r\n        while (true){\r\n            let length = this.tasks.length;\r\n            let ind = Math.floor(Math.random() * length);\r\n            ind = ind == length ? length - 1 : ind;\r\n            let taskI = this.tasks[ind];\r\n            let hasSame:boolean = false;\r\n            \r\n            for(let i = 0;i < arr.length;++i){\r\n                if(arr[i]['id'] == taskI['id']) {\r\n                    hasSame = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!hasSame) {\r\n                this.currentTask.push(taskI);\r\n                this.rezreo(taskI[\"value\"]);\r\n                return taskI;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * 定时更新任务\r\n     * 1.获取当前的日期 年月日\r\n     * 2.获取下一天0点的时间戳\r\n     * 3.当前的时间大于这个时间就给一个刷新机会\r\n     * 4.给过机会之后重新获取当前的日期 年月日\r\n     */\r\n    public setTimeDay(){\r\n        let nextDay = StateManage.instance.getData(StateManage.KEY_NEXTDAY);\r\n        \r\n        let today = StateManage.instance.getData(StateManage.KEY_TODAY);\r\n        today = today?today:this.date.getTime();\r\n\r\n        if(nextDay == 0){\r\n            this.renewal();\r\n        }else if(today > nextDay){\r\n            this.newNextDay()\r\n        }\r\n    }\r\n    public renewal(){\r\n        let time = this.date.getTime();\r\n        let newDate = new Date(time+86400000);\r\n        newDate.setHours(0,0,0);\r\n        let nextDay = newDate.getTime();\r\n        StateManage.instance.setData(StateManage.KEY_NEXTDAY,nextDay);\r\n    }\r\n    /**\r\n     * 更新目标时间\r\n     */\r\n    public newNextDay(){\r\n        let time = this.date.getTime();\r\n        let newDate = new Date(time+86400000);\r\n        newDate.setHours(0,0,0);\r\n        let nextDay = newDate.getTime();\r\n        StateManage.instance.setData(StateManage.KEY_NEXTDAY,nextDay);\r\n        this.init();\r\n    }\r\n    update (dt) {\r\n        this.sec += dt;\r\n        if(Math.floor(this.sec) == 1){\r\n            this.setTimeDay();\r\n            this.sec = 0;\r\n        }\r\n    }\r\n}\r\n"]}