import WXCore from "../gamecore/wechat/WXCore";


const {ccclass, property} = cc._decorator;

@ccclass
export default class StateManage extends cc.Node {
    private static _instance:StateManage = null;

    static KEY_SKIN:string = "skin";                    // 皮肤
    static KEY_SCORE:string = "score";                  // 得分
    static KEY_JEWEL_STATE:string = "jewel";            // 新钻石
    static KEY_ISOVER:string = 'isOver';                // 是否结束
    static KEY_CAKEPOS:string = "cakePos";              // 初始化饼的位置
    static KEY_GEM:string = "gem"                       // 宝石数量
    // 商店
    static KEY_SHOPING_TAB:string = "shoppingTab";      // 商店 TAB 
    static KEY_TRADE:string = "trade"                   // 商品价格 
    // 任务
    static KEY_OVERTURN:string = "overturn"             // 翻转次数
    static KEY_TURN:string = "turn"                     // 一周转体次数
    static KEY_TMTURN:string = "tmturn"                 // 十秒内翻转次数
    static KEY_GRADE:string = "grade"                   // 等级
    static KEY_RESURGENCECAR:string = "resurgenceCar"   // 累计使用复活卡次数
    static KEY_FDRELAY:string = "fdrelay"               // 好友接力数量
    static KEY_CRAZYTAP:string = "crazyTap"             // 疯狂点击中点次数
    static KEY_ANYSHARE:string = "anyShare"             // 累计任意分享
    static KEY_RIPESHARE:string = "ripeShare"           // 煎烤好友并分享
    static KEY_TASKNUMA:string = "tasknuma"             // A栏剩余任务次数
    static KEY_TASKNUMB:string = "tasknumb"             // B栏剩余任务次数
    static KEY_TASKNUMC:string = "tasknumc"             // C栏剩余任务次数
    static KEY_NEXTDAY:string = "nextDay"               // 第二天 0 点
    static KEY_TASKA:string = "taska"                   // A栏剩余任务次数
    static KEY_TASKB:string = "taskb"                   // B栏剩余任务次数
    static KEY_TASKC:string = "taskc"                   // C栏剩余任务次数


    public skin:string = "defult";
    public score:string = "0";
    public jewel:Number = 0;
    public shoppingTab:number = 0;
    public isOver:number = 2;
    public cakePos:any = null;
    public gem:number = 0;
    public trade:object = {};

    public overturn:number = 0;
    public turn:number = 0;
    public tmturn:number = 0;
    public grade:number = 0;
    public resurgenceCar:number = 0;
    public fdrelay:number = 0;
    public crazyTap:number = 0;
    public anyShare:number = 0;
    public ripeShare:number = 0;
    public tasknuma:number = 0;
    public tasknumb:number = 0;
    public tasknumc:number = 0;
    public nextDay:number = 0;
    public currentTask:Array<object> = [];
    public taska:object = {};
    public taskb:object = {};
    public taskc:object = {};

    public static get instance():StateManage {
        if (!StateManage._instance) StateManage._instance = new StateManage();
        
        return StateManage._instance;
    }

    private _lastChangedKey:string;

    /**
     *  被修改的 KEY
     */
    public get lastChangedKey():string {
        return this._lastChangedKey;
    }

    
    // KEY 抛出改变事件
    public setData(key:string, value:any){

        if (this[key] !== value && this[key] != void 0) {
            this[key] = value;

            this._lastChangedKey = key;
            WXCore.setStorage(key,value);
            this.dispatchEvent(new cc.Event("change", false));
        }
    }
    // 获取状态
    public getData(key:string){
        /* let value = WXCore.getStorage(key);
        if(this[key] && value){
            return value;
        } */
        if(this[key] != void 0){
            return this[key];
        }
    }
}
