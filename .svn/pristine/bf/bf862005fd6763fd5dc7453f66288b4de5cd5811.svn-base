{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\xiaoyaoji/assets\\Script\\gamecore\\xiaoyaoji\\AdButton.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\gamecore\\xiaoyaoji","sourcesContent":["import { TweenLite, Ease } from \"../libs/TweenLite\";\r\nimport { Bounce, Elastic } from \"../libs/EasePack\";\r\nimport GameManager from \"../managers/GameManager\";\r\nimport XYJAPI from \"./XYJAPI\";\r\nimport WXCore from \"../wechat/WXCore\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 广告按钮\r\n */\r\n\r\n@ccclass\r\nexport default class AdButton extends cc.Component {\r\n\r\n    /**\r\n     * 动画间隔\r\n     */\r\n    effectDelay:number = 3;\r\n\r\n    start () {\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.tapHandler, this);\r\n\r\n        this.showEffect();\r\n\r\n        this.schedule(this.getAdData, 2, 1);\r\n\r\n        //默认不可见\r\n        // this.node.active = false;\r\n        this.node.opacity = 0;\r\n    }\r\n\r\n    /**\r\n     * {\r\n     *      imageurl: \"https://ball.yz071.com/Upload/image/2018-06-06/P_15282657218141544.jpg \", \r\n     *      title: \"篮球大作战\", \r\n     *      bili: \"4:3\"\r\n     * }\r\n     */\r\n    private _adData:object;\r\n\r\n    private getAdData():void {\r\n        cc.info(\"get ad data\");\r\n        if (this._adData) return;\r\n\r\n        //请求数据\r\n        let script:AdButton = this;\r\n        XYJAPI.getAdImageData(function(data:object):void {\r\n            if (data && data[\"imageurl\"]) {\r\n                script._adData = data;\r\n                //script.node.active = true;\r\n                script.node.opacity = 255;\r\n            }\r\n        });\r\n\r\n        this.schedule(this.getAdData, 3, 1);\r\n    }\r\n\r\n\r\n    // update (dt) {}\r\n\r\n    /**\r\n     * 广告按钮点击\r\n     * @param e \r\n     */\r\n    private tapHandler(e:cc.Event.EventTouch):void {\r\n        if (this.node.opacity < 10) return;\r\n        \r\n        GameManager.soundsManager.playTapSound();\r\n\r\n        //预览图片\r\n        if (this._adData) {\r\n            WXCore.previewImage([this._adData[\"imageurl\"]]);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 播放效果\r\n     */\r\n    private showEffect():void {\r\n        this.node.stopAllActions();\r\n        \r\n        if (this._adData) {\r\n            if (Math.random() > 0.5) {\r\n                this.effectZoom();\r\n            } else {\r\n                this.effectShake();\r\n            }\r\n        }\r\n\r\n        this.schedule(this.showEffect, this.effectDelay + Math.random(), 1);\r\n    }\r\n\r\n\r\n    private shakeTween:any;\r\n\r\n    /**\r\n     * 晃动\r\n     */\r\n    private effectShake():void {\r\n        let toR:number = (40 + Math.random() * 10) * (Math.random() > 0.5 ? 1 : -1);\r\n        \r\n        // let cc.sequence(cc.rotateTo(0.5, toR));\r\n        let act:cc.ActionInterval = cc.sequence(\r\n            cc.rotateTo(0.5, toR),\r\n            cc.rotateTo(0.5, 0).easing(cc.easeBounceOut())\r\n        )\r\n\r\n        this.node.runAction(act);\r\n        // let t:any = TweenLite.to(this.node, 0.5, {\"rotation\":toR});\r\n        // this._tweenlites.push(t);\r\n\r\n        // t = TweenLite.to(this.node, 0.8, {\r\n        //     \"delay\":0.5,\r\n        //     \"rotation\":0,\r\n        //     \"ease\":Elastic.easeOut\r\n        // });\r\n        // this._tweenlites.push(t);\r\n\r\n    }\r\n\r\n\r\n    /**\r\n     * 缩放\r\n     */\r\n    private effectZoom():void {\r\n        let toS:number = 0.6 + Math.random() * 0.2;\r\n\r\n        // let cc.sequence(cc.rotateTo(0.5, toR));\r\n        let act:cc.ActionInterval = cc.sequence(\r\n            cc.scaleTo(0.5, toS),\r\n            cc.scaleTo(0.5, 1).easing(cc.easeBounceOut())\r\n        )\r\n\r\n        this.node.runAction(act);\r\n    }\r\n\r\n\r\n    onDestroy() {\r\n        this.node.stopAllActions();\r\n\r\n        this.unschedule(this.showEffect);\r\n        this.unschedule(this.getAdData);\r\n    }\r\n}\r\n"]}